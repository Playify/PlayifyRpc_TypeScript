{"version":3,"file":"rpc.cjs","sources":["../src/types/errors/RpcCustomErrorDecorator.ts","../node_modules/stackframe/stackframe.js","../node_modules/error-stack-parser/error-stack-parser.js","../src/types/RpcError.ts","../src/connection/RpcId.ts","../src/types/errors/PredefinedErrors.ts","../src/internal/RegisteredTypes.ts","../src/types/functions/PendingCall.ts","../src/types/functions/FunctionCallContext.ts","../src/types/RpcFunction.ts","../src/types/RpcObject.ts","../src/types/data/DynamicData.ts","../src/types/data/DataOutput.ts","../src/connection/Connection.ts","../src/types/data/DataInput.ts","../src/connection/WebSocketConnection.ts","../src/connection/RpcName.ts","../src/types/data/CustomDynamicTypeDecorator.ts","../src/types/RpcProviderDecorator.ts","../src/rpc.ts"],"sourcesContent":["import {RpcError} from \"../RpcError.js\";\r\n\r\nexport const RpcCustomErrors:[\r\n\tMap<string,typeof RpcError>,\r\n\tMap<typeof RpcError,string>\r\n]=[new Map,new Map];\r\nexport function RpcCustomError(typeTag: string){\r\n\treturn function(target: typeof RpcError){\r\n\t\tconst [tagToError,errorToTag]=RpcCustomErrors;\r\n\t\ttagToError.set(typeTag,target);\r\n\t\terrorToTag.set(target,typeTag);\r\n\t};\r\n}","(function(root, factory) {\n    'use strict';\n    // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js, Rhino, and browsers.\n\n    /* istanbul ignore next */\n    if (typeof define === 'function' && define.amd) {\n        define('stackframe', [], factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory();\n    } else {\n        root.StackFrame = factory();\n    }\n}(this, function() {\n    'use strict';\n    function _isNumber(n) {\n        return !isNaN(parseFloat(n)) && isFinite(n);\n    }\n\n    function _capitalize(str) {\n        return str.charAt(0).toUpperCase() + str.substring(1);\n    }\n\n    function _getter(p) {\n        return function() {\n            return this[p];\n        };\n    }\n\n    var booleanProps = ['isConstructor', 'isEval', 'isNative', 'isToplevel'];\n    var numericProps = ['columnNumber', 'lineNumber'];\n    var stringProps = ['fileName', 'functionName', 'source'];\n    var arrayProps = ['args'];\n    var objectProps = ['evalOrigin'];\n\n    var props = booleanProps.concat(numericProps, stringProps, arrayProps, objectProps);\n\n    function StackFrame(obj) {\n        if (!obj) return;\n        for (var i = 0; i < props.length; i++) {\n            if (obj[props[i]] !== undefined) {\n                this['set' + _capitalize(props[i])](obj[props[i]]);\n            }\n        }\n    }\n\n    StackFrame.prototype = {\n        getArgs: function() {\n            return this.args;\n        },\n        setArgs: function(v) {\n            if (Object.prototype.toString.call(v) !== '[object Array]') {\n                throw new TypeError('Args must be an Array');\n            }\n            this.args = v;\n        },\n\n        getEvalOrigin: function() {\n            return this.evalOrigin;\n        },\n        setEvalOrigin: function(v) {\n            if (v instanceof StackFrame) {\n                this.evalOrigin = v;\n            } else if (v instanceof Object) {\n                this.evalOrigin = new StackFrame(v);\n            } else {\n                throw new TypeError('Eval Origin must be an Object or StackFrame');\n            }\n        },\n\n        toString: function() {\n            var fileName = this.getFileName() || '';\n            var lineNumber = this.getLineNumber() || '';\n            var columnNumber = this.getColumnNumber() || '';\n            var functionName = this.getFunctionName() || '';\n            if (this.getIsEval()) {\n                if (fileName) {\n                    return '[eval] (' + fileName + ':' + lineNumber + ':' + columnNumber + ')';\n                }\n                return '[eval]:' + lineNumber + ':' + columnNumber;\n            }\n            if (functionName) {\n                return functionName + ' (' + fileName + ':' + lineNumber + ':' + columnNumber + ')';\n            }\n            return fileName + ':' + lineNumber + ':' + columnNumber;\n        }\n    };\n\n    StackFrame.fromString = function StackFrame$$fromString(str) {\n        var argsStartIndex = str.indexOf('(');\n        var argsEndIndex = str.lastIndexOf(')');\n\n        var functionName = str.substring(0, argsStartIndex);\n        var args = str.substring(argsStartIndex + 1, argsEndIndex).split(',');\n        var locationString = str.substring(argsEndIndex + 1);\n\n        if (locationString.indexOf('@') === 0) {\n            var parts = /@(.+?)(?::(\\d+))?(?::(\\d+))?$/.exec(locationString, '');\n            var fileName = parts[1];\n            var lineNumber = parts[2];\n            var columnNumber = parts[3];\n        }\n\n        return new StackFrame({\n            functionName: functionName,\n            args: args || undefined,\n            fileName: fileName,\n            lineNumber: lineNumber || undefined,\n            columnNumber: columnNumber || undefined\n        });\n    };\n\n    for (var i = 0; i < booleanProps.length; i++) {\n        StackFrame.prototype['get' + _capitalize(booleanProps[i])] = _getter(booleanProps[i]);\n        StackFrame.prototype['set' + _capitalize(booleanProps[i])] = (function(p) {\n            return function(v) {\n                this[p] = Boolean(v);\n            };\n        })(booleanProps[i]);\n    }\n\n    for (var j = 0; j < numericProps.length; j++) {\n        StackFrame.prototype['get' + _capitalize(numericProps[j])] = _getter(numericProps[j]);\n        StackFrame.prototype['set' + _capitalize(numericProps[j])] = (function(p) {\n            return function(v) {\n                if (!_isNumber(v)) {\n                    throw new TypeError(p + ' must be a Number');\n                }\n                this[p] = Number(v);\n            };\n        })(numericProps[j]);\n    }\n\n    for (var k = 0; k < stringProps.length; k++) {\n        StackFrame.prototype['get' + _capitalize(stringProps[k])] = _getter(stringProps[k]);\n        StackFrame.prototype['set' + _capitalize(stringProps[k])] = (function(p) {\n            return function(v) {\n                this[p] = String(v);\n            };\n        })(stringProps[k]);\n    }\n\n    return StackFrame;\n}));\n","(function(root, factory) {\n    'use strict';\n    // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js, Rhino, and browsers.\n\n    /* istanbul ignore next */\n    if (typeof define === 'function' && define.amd) {\n        define('error-stack-parser', ['stackframe'], factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory(require('stackframe'));\n    } else {\n        root.ErrorStackParser = factory(root.StackFrame);\n    }\n}(this, function ErrorStackParser(StackFrame) {\n    'use strict';\n\n    var FIREFOX_SAFARI_STACK_REGEXP = /(^|@)\\S+:\\d+/;\n    var CHROME_IE_STACK_REGEXP = /^\\s*at .*(\\S+:\\d+|\\(native\\))/m;\n    var SAFARI_NATIVE_CODE_REGEXP = /^(eval@)?(\\[native code])?$/;\n\n    return {\n        /**\n         * Given an Error object, extract the most information from it.\n         *\n         * @param {Error} error object\n         * @return {Array} of StackFrames\n         */\n        parse: function ErrorStackParser$$parse(error) {\n            if (typeof error.stacktrace !== 'undefined' || typeof error['opera#sourceloc'] !== 'undefined') {\n                return this.parseOpera(error);\n            } else if (error.stack && error.stack.match(CHROME_IE_STACK_REGEXP)) {\n                return this.parseV8OrIE(error);\n            } else if (error.stack) {\n                return this.parseFFOrSafari(error);\n            } else {\n                throw new Error('Cannot parse given Error object');\n            }\n        },\n\n        // Separate line and column numbers from a string of the form: (URI:Line:Column)\n        extractLocation: function ErrorStackParser$$extractLocation(urlLike) {\n            // Fail-fast but return locations like \"(native)\"\n            if (urlLike.indexOf(':') === -1) {\n                return [urlLike];\n            }\n\n            var regExp = /(.+?)(?::(\\d+))?(?::(\\d+))?$/;\n            var parts = regExp.exec(urlLike.replace(/[()]/g, ''));\n            return [parts[1], parts[2] || undefined, parts[3] || undefined];\n        },\n\n        parseV8OrIE: function ErrorStackParser$$parseV8OrIE(error) {\n            var filtered = error.stack.split('\\n').filter(function(line) {\n                return !!line.match(CHROME_IE_STACK_REGEXP);\n            }, this);\n\n            return filtered.map(function(line) {\n                if (line.indexOf('(eval ') > -1) {\n                    // Throw away eval information until we implement stacktrace.js/stackframe#8\n                    line = line.replace(/eval code/g, 'eval').replace(/(\\(eval at [^()]*)|(,.*$)/g, '');\n                }\n                var sanitizedLine = line.replace(/^\\s+/, '').replace(/\\(eval code/g, '(').replace(/^.*?\\s+/, '');\n\n                // capture and preseve the parenthesized location \"(/foo/my bar.js:12:87)\" in\n                // case it has spaces in it, as the string is split on \\s+ later on\n                var location = sanitizedLine.match(/ (\\(.+\\)$)/);\n\n                // remove the parenthesized location from the line, if it was matched\n                sanitizedLine = location ? sanitizedLine.replace(location[0], '') : sanitizedLine;\n\n                // if a location was matched, pass it to extractLocation() otherwise pass all sanitizedLine\n                // because this line doesn't have function name\n                var locationParts = this.extractLocation(location ? location[1] : sanitizedLine);\n                var functionName = location && sanitizedLine || undefined;\n                var fileName = ['eval', '<anonymous>'].indexOf(locationParts[0]) > -1 ? undefined : locationParts[0];\n\n                return new StackFrame({\n                    functionName: functionName,\n                    fileName: fileName,\n                    lineNumber: locationParts[1],\n                    columnNumber: locationParts[2],\n                    source: line\n                });\n            }, this);\n        },\n\n        parseFFOrSafari: function ErrorStackParser$$parseFFOrSafari(error) {\n            var filtered = error.stack.split('\\n').filter(function(line) {\n                return !line.match(SAFARI_NATIVE_CODE_REGEXP);\n            }, this);\n\n            return filtered.map(function(line) {\n                // Throw away eval information until we implement stacktrace.js/stackframe#8\n                if (line.indexOf(' > eval') > -1) {\n                    line = line.replace(/ line (\\d+)(?: > eval line \\d+)* > eval:\\d+:\\d+/g, ':$1');\n                }\n\n                if (line.indexOf('@') === -1 && line.indexOf(':') === -1) {\n                    // Safari eval frames only have function names and nothing else\n                    return new StackFrame({\n                        functionName: line\n                    });\n                } else {\n                    var functionNameRegex = /((.*\".+\"[^@]*)?[^@]*)(?:@)/;\n                    var matches = line.match(functionNameRegex);\n                    var functionName = matches && matches[1] ? matches[1] : undefined;\n                    var locationParts = this.extractLocation(line.replace(functionNameRegex, ''));\n\n                    return new StackFrame({\n                        functionName: functionName,\n                        fileName: locationParts[0],\n                        lineNumber: locationParts[1],\n                        columnNumber: locationParts[2],\n                        source: line\n                    });\n                }\n            }, this);\n        },\n\n        parseOpera: function ErrorStackParser$$parseOpera(e) {\n            if (!e.stacktrace || (e.message.indexOf('\\n') > -1 &&\n                e.message.split('\\n').length > e.stacktrace.split('\\n').length)) {\n                return this.parseOpera9(e);\n            } else if (!e.stack) {\n                return this.parseOpera10(e);\n            } else {\n                return this.parseOpera11(e);\n            }\n        },\n\n        parseOpera9: function ErrorStackParser$$parseOpera9(e) {\n            var lineRE = /Line (\\d+).*script (?:in )?(\\S+)/i;\n            var lines = e.message.split('\\n');\n            var result = [];\n\n            for (var i = 2, len = lines.length; i < len; i += 2) {\n                var match = lineRE.exec(lines[i]);\n                if (match) {\n                    result.push(new StackFrame({\n                        fileName: match[2],\n                        lineNumber: match[1],\n                        source: lines[i]\n                    }));\n                }\n            }\n\n            return result;\n        },\n\n        parseOpera10: function ErrorStackParser$$parseOpera10(e) {\n            var lineRE = /Line (\\d+).*script (?:in )?(\\S+)(?:: In function (\\S+))?$/i;\n            var lines = e.stacktrace.split('\\n');\n            var result = [];\n\n            for (var i = 0, len = lines.length; i < len; i += 2) {\n                var match = lineRE.exec(lines[i]);\n                if (match) {\n                    result.push(\n                        new StackFrame({\n                            functionName: match[3] || undefined,\n                            fileName: match[2],\n                            lineNumber: match[1],\n                            source: lines[i]\n                        })\n                    );\n                }\n            }\n\n            return result;\n        },\n\n        // Opera 10.65+ Error.stack very similar to FF/Safari\n        parseOpera11: function ErrorStackParser$$parseOpera11(error) {\n            var filtered = error.stack.split('\\n').filter(function(line) {\n                return !!line.match(FIREFOX_SAFARI_STACK_REGEXP) && !line.match(/^Error created at/);\n            }, this);\n\n            return filtered.map(function(line) {\n                var tokens = line.split('@');\n                var locationParts = this.extractLocation(tokens.pop());\n                var functionCall = (tokens.shift() || '');\n                var functionName = functionCall\n                    .replace(/<anonymous function(: (\\w+))?>/, '$2')\n                    .replace(/\\([^)]*\\)/g, '') || undefined;\n                var argsRaw;\n                if (functionCall.match(/\\(([^)]*)\\)/)) {\n                    argsRaw = functionCall.replace(/^[^(]+\\(([^)]*)\\)$/, '$1');\n                }\n                var args = (argsRaw === undefined || argsRaw === '[arguments not available]') ?\n                    undefined : argsRaw.split(',');\n\n                return new StackFrame({\n                    functionName: functionName,\n                    args: args,\n                    fileName: locationParts[0],\n                    lineNumber: locationParts[1],\n                    columnNumber: locationParts[2],\n                    source: line\n                });\n            }, this);\n        }\n    };\n}));\n","import {DataInput,DataOutput,Rpc} from \"../rpc.js\";\r\nimport {RpcCustomErrors} from \"./errors/RpcCustomErrorDecorator.js\";\r\nimport ErrorStackParser,{StackFrame} from \"error-stack-parser\";\r\n\r\nfunction fixString(s:string){\r\n\treturn s.replaceAll(\"\\r\",\"\")\r\n\t\t.replaceAll(/^\\n+|\\n+$/g,\"\")\r\n\t\t.replaceAll(/^  +/gm,\"\\t\");\r\n}\r\n\r\nfunction framesToString(frames:StackFrame[]):string{\r\n\tlet result=\"\";\r\n\tfor(let frame of frames)\r\n\t\tif(frame.functionName?.includes(\"$RPC_MARKER_BEGIN$\")) break;\r\n\t\telse result+=\"\\n\\tat \"+frame;\r\n\treturn result;\r\n}\r\n\r\nfunction causeToString(cause:unknown):string{\r\n\tif(cause===undefined) return \"\";\r\n\tif(cause instanceof RpcError) return \"\\ncaused by: \"+cause.toString();\r\n\tif(cause instanceof Error)\r\n\t\treturn \"\\ncaused by: \"+fixString(cause.toString())\r\n\t\t\t+framesToString(ErrorStackParser.parse(cause))\r\n\t\t\t+causeToString(cause.cause);\r\n\treturn \"\\ncaused by: \"+fixString(cause?.toString()??\"null\");\r\n}\r\n\r\n\r\n//Remove RpcError inheritance from stack trace\r\nfunction removeFromStackTrace(e:typeof RpcError & {__proto__:any},ownStack:StackFrame[]):boolean{\r\n\tif((e===RpcError||removeFromStackTrace(e.__proto__,ownStack))\r\n\t\t&&ownStack[0].functionName?.replace(/^new /,\"\")===e.name){\r\n\t\townStack.shift();\r\n\t\treturn true;\r\n\t}else return false;\r\n}\r\n\r\nexport class RpcError extends Error{\r\n\t//public get type(){return this.name}\r\n\r\n\tpublic readonly from:string;\r\n\tpublic readonly data:Record<string,any>={};\r\n\t#ownStack:StackFrame[]=[];\r\n\r\n\tpublic get stackTrace(){\r\n\t\tlet result=this.#stackTrace;\r\n\t\tresult+=framesToString(this.#ownStack);\r\n\t\tresult+=this.#causes;\r\n\t\treturn result.replaceAll(/^\\n+/g,\"\");\r\n\t}\r\n\r\n\t#stackTrace:string=\"\";\r\n\t#appendStack=false;\r\n\treadonly #causes:string=\"\";\r\n\r\n\tconstructor(message:string);\r\n\tconstructor(message:string,cause:Error | unknown);\r\n\tconstructor(type:string | null,from:string | null,message:string | null,stackTrace:string | null);\r\n\tconstructor(type:string | null,from:string | null,message:string | null,stackTrace:string | null,cause:Error);\r\n\tconstructor(type:string | null,from:string | null,message:string | null,stackTrace:string | null,data:Record<string,any>);\r\n\tconstructor(type:string | null,from:string | null,message:string | null,stackTrace:string | null,data:Record<string,any>,cause:Error | unknown);\r\n\tconstructor(...args:\r\n\t\t\t\t\t[message:string] |\r\n\t\t\t\t\t[message:string,cause:Error | unknown] |\r\n\t\t\t\t\t[type:string | null,from:string | null,message:string | null,stackTrace:string | null] |\r\n\t\t\t\t\t[type:string | null,from:string | null,message:string | null,stackTrace:string | null,cause:Error] |\r\n\t\t\t\t\t[type:string | null,from:string | null,message:string | null,stackTrace:string | null,data:Record<string,any>] |\r\n\t\t\t\t\t[type:string | null,from:string | null,message:string | null,stackTrace:string | null,data:Record<string,any>,cause:Error | unknown]\r\n\t){\r\n\t\tlet type:string | null=null;\r\n\t\tlet from:string | null=null;\r\n\t\tlet message:string | null=null;\r\n\t\tlet stackTrace:string | null=null;\r\n\t\tlet data:Record<string,any>={};\r\n\t\tlet cause:Error | unknown | undefined=undefined;\r\n\r\n\t\tswitch(args.length){\r\n\t\t\tcase 1:\r\n\t\t\t\t[message]=args;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\t[message,cause]=args;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 4:\r\n\t\t\t\t[message,from,message,stackTrace]=args;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5:\r\n\t\t\t\tif(args[4] instanceof RpcError) [message,from,message,stackTrace,cause]=args;\r\n\t\t\t\telse [message,from,message,stackTrace,data]=args;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 6:\r\n\t\t\t\t[message,from,message,stackTrace,data,cause]=args;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"Invalid arg count\");\r\n\t\t}\r\n\r\n\t\tif(cause!=null) super(message??undefined,{cause});\r\n\t\telse super(message??undefined);\r\n\r\n\t\tthis.name=type??this.constructor.name;\r\n\t\tthis.from=from??Rpc.prettyName;\r\n\r\n\t\tconst typeTag=RpcCustomErrors[1].get(this.constructor as any);\r\n\t\tif(typeTag!=null) this.data[\"$type\"]=typeTag;\r\n\t\tObject.assign(this.data,data??{});\r\n\r\n\r\n\t\tif(stackTrace==null){\r\n\t\t\tthis.#appendStack=true;\r\n\t\t\tthis.#ownStack=ErrorStackParser.parse(this);\r\n\t\t\tremoveFromStackTrace(this.constructor as any,this.#ownStack);\r\n\t\t}else{\r\n\t\t\tthis.#stackTrace=\"\\n\"+fixString(stackTrace);\r\n\t\t\tconst causeIndex=this.#stackTrace.indexOf(\"\\ncaused by: \");\r\n\t\t\tif(causeIndex!= -1){\r\n\t\t\t\tthis.#causes+=this.#stackTrace.substring(causeIndex);\r\n\t\t\t\tthis.#stackTrace=this.#stackTrace.substring(0,causeIndex);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.#causes+=causeToString(cause);\r\n\r\n\t\tthis.stack=this.toString();\r\n\t}\r\n\r\n\ttoString(){\r\n\t\tlet s=this.name+\"(\"+this.from+\")\";\r\n\t\tif(this.message?.trim()) s+=\": \"+this.message;\r\n\r\n\t\tconst trace=this.stackTrace;\r\n\t\tif(trace?.trim()) s+=\"\\n\"+trace;\r\n\r\n\t\treturn s;\r\n\t}\r\n\r\n\twrite(output:DataOutput){\r\n\t\toutput.writeString(this.name);\r\n\t\toutput.writeString(this.from);\r\n\t\toutput.writeString(this.message);\r\n\t\toutput.writeString(this.stackTrace);\r\n\t\toutput.writeString(Object.keys(this.data).length==0?null:JSON.stringify(this.data));\r\n\t}\r\n\r\n\tstatic read(input:DataInput){\r\n\t\tconst type=input.readString();\r\n\t\tconst from=input.readString()??\"???\";\r\n\t\tconst message=input.readString();\r\n\t\tconst stackTrace=input.readString()??\"\";\r\n\r\n\t\tlet data;\r\n\t\ttry{\r\n\t\t\tdata=JSON.parse(input.readString()??\"null\");\r\n\t\t}catch(e){\r\n\t\t\tif(e instanceof RangeError)\r\n\t\t\t\tdata={\"$info\":\"JsonData was not included, due to an old PlayifyRpc version\"};\r\n\t\t\telse throw e;\r\n\t\t}\r\n\r\n\t\treturn RpcError.create(type,from,message,stackTrace,data);\r\n\t}\r\n\r\n\tstatic create(type:string | null,from:string,message:string | null,stackTrace:string,data:Record<string,any>){\r\n\t\tconst typeTag=data?.[\"$type\"];\r\n\t\tconst constructor:typeof RpcError=RpcCustomErrors[0].get(typeTag)??RpcError;\r\n\t\treturn new constructor(type,from,message,stackTrace,data);\r\n\t}\r\n\r\n\r\n\tstatic wrapAndFreeze(e:Error):RpcError{\r\n\t\tif(e instanceof RpcError){\r\n\t\t\tif(!e.#appendStack) return e;\r\n\t\t\te.#appendStack=false;\r\n\t\t\te.#stackTrace+=framesToString(e.#ownStack);\r\n\t\t\te.#ownStack=[];\r\n\t\t\te.stack=e.toString();\r\n\t\t\treturn e;\r\n\t\t}\r\n\r\n\t\treturn new RpcError(\r\n\t\t\te.name,\r\n\t\t\te instanceof RpcError?e.from:null,\r\n\t\t\te.message,\r\n\t\t\tframesToString(ErrorStackParser.parse(e)).substring(1),\r\n\t\t\t{},\r\n\t\t\te.cause as Error,\r\n\t\t);\r\n\t}\r\n\r\n\tunfreeze(stackSource:Error,skip:number){\r\n\t\tif(this.#appendStack) return this;\r\n\t\tthis.#appendStack=true;\r\n\t\tthis.#ownStack=ErrorStackParser.parse(stackSource).slice(skip);\r\n\t\tthis.stack=this.toString();\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\ttrashLocalStack(){\r\n\t\tthis.#appendStack=false;\r\n\t\tthis.#ownStack=[];\r\n\t\tthis.stack=this.toString();\r\n\t\treturn this;\r\n\t}\r\n\r\n\tappend(type:string | null,method:string | null,args:any[] | null){\r\n\t\tthis.#stackTrace+=\"\\n\\trpc \"+(args==null\r\n\t\t\t?\"<<callLocal>>\"\r\n\t\t\t:(type??\"<<null>>\")+\".\"+(method??\"<<null>>\")+\"(\"+\r\n\t\t\targs.map(a=>JSON.stringify(a)).join(\",\")+\")\");\r\n\t\tthis.stack=this.toString();\r\n\t\treturn this;\r\n\t}\r\n}","export const isNodeJs=globalThis?.process?.versions?.node!=null;\r\n\r\nconst chars=\"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\r\nexport const randomId=()=>Date.now().toString(36)+Array(10)\r\n\t.fill(undefined)\r\n\t.map(()=>chars[Math.floor(Math.random()*chars.length)])\r\n\t.join(\"\");\r\n\r\n\r\n//RpcId\r\nexport let RpcId:string;\r\nif(isNodeJs)\r\n\ttry{\r\n\t\tif(process?.versions.bun)\r\n\t\t\tRpcId=\"bun@\"+require(\"os\").hostname()+\"@\"+process.pid;\r\n\t\telse\r\n\t\t\t//@ts-ignore\r\n\t\t\t// noinspection JSUnresolvedReference\r\n\t\t\tRpcId=\"node@\"+process.binding(\"os\").getHostname()+\"@\"+process.pid;//Needed to not use top level await\r\n\t}catch{\r\n\t\tRpcId=\"node-alternative@\"+process.platform+\":\"+process.arch+\"@\"+process.pid;\r\n\t}\r\nelse if(\"document\" in globalThis) RpcId=\"web@\"+document.location+\"#\"+randomId();\r\nelse//Unknown Platform\r\n\tRpcId=\"js@\"+randomId();","import {RpcError} from \"../RpcError.js\";\r\nimport {RpcCustomError} from \"./RpcCustomErrorDecorator.js\";\r\n\r\nconst quoted=(s:string | null)=>s==null?\"null\":\"\\\"\"+s+\"\\\"\";\r\n\r\nexport abstract class RpcCallError extends RpcError{}\r\n\r\n@RpcCustomError(\"$type\")\r\nexport class RpcTypeNotFoundError extends RpcCallError{\r\n\tstatic new=(type:string | null)=>new RpcTypeNotFoundError(null,null,\r\n\t\t`Type ${quoted(type)} does not exist`,\"\",{type});\r\n}\r\n\r\n@RpcCustomError(\"$method\")\r\nexport class RpcMethodNotFoundError extends RpcCallError{\r\n\tstatic new=(type:string | null,method:string | null)=>new RpcMethodNotFoundError(null,null,\r\n\t\t`Method ${quoted(method)} does not exist on type ${quoted(type)}`,\"\",{type,method});\r\n}\r\n\r\n@RpcCustomError(\"$method-meta\")\r\nexport class RpcMetaMethodNotFoundError extends RpcMethodNotFoundError{\r\n\tstatic new=(type:string | null,meta:string | null)=>new RpcMetaMethodNotFoundError(null,null,\r\n\t\t`Meta-Method ${quoted(meta)} does not exist on type ${quoted(type)}`,\"\",{type,method:null,meta});\r\n}\r\n\r\n@RpcCustomError(\"$connection\")\r\nexport class RpcConnectionError extends RpcCallError{\r\n\tstatic new=(message:string | null)=>new RpcConnectionError(null,null,message,\"\");\r\n}\r\n\r\n@RpcCustomError(\"$eval\")\r\nexport class RpcEvalError extends RpcCallError{}\r\n\r\n@RpcCustomError(\"$data\")\r\nexport class RpcDataError extends RpcError{\r\n\tstatic new=(message:string,cause:Error)=>new RpcDataError(null,null,message,\"\",cause);\r\n}","import {isConnected} from \"../connection/WebSocketConnection.js\";\r\nimport {randomId,RpcId} from \"../connection/RpcId.js\";\r\nimport {callRemoteFunction} from \"../types/functions/FunctionCallContext.js\";\r\nimport {RpcObjectGetMethods} from \"../types/RpcObject.js\";\r\nimport {RpcError} from \"../types/RpcError.js\";\r\nimport {RpcMetaMethodNotFoundError,RpcMethodNotFoundError} from \"../types/errors/PredefinedErrors.js\";\r\n\r\n\r\nexport type Func=(...args:any[])=>Promise<any>;\r\nexport type Invoker={\r\n\t[RpcObjectGetMethods]?:()=>Promise<string[]>,\r\n\t[s:string]:Func | any,\r\n};\r\nexport const registeredFunctions:Invoker=Object.create(null);\r\nexport const registeredTypes=new Map<string,Invoker>();\r\nregisteredTypes.set(\"$\"+RpcId,registeredFunctions);\r\n\r\n\r\nexport async function generateTypeName(){\r\n\treturn \"$\"+RpcId+\"$\"+randomId();\r\n}\r\n\r\nexport async function registerType(type:string,invoker:Invoker):Promise<void>{\r\n\tif(registeredTypes.has(type)) return;\r\n\tregisteredTypes.set(type,invoker);\r\n\t\r\n\ttry{\r\n\t\tif(isConnected)\r\n\t\t\tawait callRemoteFunction(null,'+',type);\r\n\t}catch(e){\r\n\t\tconsole.error(`[Rpc] Error registering type \"${type}\":`,e);\r\n\r\n\t\tregisteredTypes.delete(type);\r\n\t}\r\n}\r\n\r\nexport async function unregisterType(type:string):Promise<void>{\r\n\tif(!registeredTypes.has(type)) return;\r\n\r\n\ttry{\r\n\t\tif(isConnected)\r\n\t\t\tawait callRemoteFunction(null,'-',type);\r\n\t}catch(e){\r\n\t\tconsole.error(`[Rpc] Error unregistering type \"${type}\":`,e);\r\n\r\n\t\t//Also delete locally, as it won't be listened to, and on the server it probably is already unregistered\r\n\t}\r\n\tregisteredTypes.delete(type);\r\n}\r\n\r\n\r\nasync function getMethods(invoker:Invoker):Promise<string[]>{\r\n\tconst getter=invoker[RpcObjectGetMethods];\r\n\tif(getter) return await getter.call(invoker);\r\n\r\n\treturn Object.getOwnPropertyNames(invoker).filter(key=>typeof invoker[key]==\"function\");\r\n}\r\n\r\nexport async function invoke(invoker:Invoker,type:string,method:string | null,...args:any[]):Promise<any>{\r\n\tif(method!=null){\r\n\t\tlet func=invoker[method];\r\n\t\tif(func==null){\r\n\t\t\tlet ignoreCase=(await getMethods(invoker)).find(s=>s.toLowerCase()==method.toLowerCase());\r\n\t\t\tif(ignoreCase!=null) func=invoker[ignoreCase];\r\n\t\t}\r\n\t\t//Try finding the same method on a default object, if it is reference equals, then it is a builtin function, that should not be available via RPC\r\n\t\tconst reference=({})[method];\r\n\r\n\t\tif(func==null||func===reference)throw RpcMethodNotFoundError.new(type,method);\r\n\t\ttry{\r\n\t\t\treturn await (({\r\n\t\t\t\tasync $RPC_MARKER_BEGIN$(){\r\n\t\t\t\t\treturn await func.call(invoker,...args);\r\n\t\t\t\t}\r\n\t\t\t})[\"$RPC_MARKER_BEGIN$\"])();\r\n\t\t\t//return await rpcMarkInternal(async()=>await func.call(invoker,...args));\r\n\t\t}catch(e){\r\n\t\t\tthrow RpcError.wrapAndFreeze(e as Error);\r\n\t\t}\r\n\t}\r\n\r\n\tconst meta=args.length==0?null:args[0];\r\n\tswitch(meta){\r\n\t\tcase \"M\":\r\n\t\t\treturn getMethods(invoker);\r\n\t\tdefault:\r\n\t\t\tthrow RpcMetaMethodNotFoundError.new(type,meta);\r\n\t}\r\n}","import {FunctionCallContext} from \"./FunctionCallContext.js\";\r\nimport {RpcError} from \"../RpcError.js\";\r\nimport {freeDynamic} from \"../data/DynamicData.js\";\r\nimport {Rpc} from \"../../rpc\";\r\n\r\ntype Action<T>=(t:T)=>void;\r\n\r\n// noinspection JSUnusedGlobalSymbols\r\nexport class PendingCall<T=unknown> implements Promise<T>{\r\n\tpublic readonly [Symbol.toStringTag]:string=\"PendingCall\";\r\n\tpublic finished=false;\r\n\tpublic readonly promise:Promise<T>;\r\n\r\n\tconstructor(skip:number,dispose:unknown[]){\r\n\t\ttry{\r\n\t\t\t// noinspection ExceptionCaughtLocallyJS\r\n\t\t\tthrow new Error();\r\n\t\t}catch(stackSource){\r\n\t\t\tthis.promise=new Promise((resolve,reject)=>{\r\n\t\t\t\tresolveCall.set(this,t=>{\r\n\t\t\t\t\tresolveCall.delete(this);\r\n\t\t\t\t\trejectCall.delete(this);\r\n\t\t\t\t\tthis.finished=true;\r\n\t\t\t\t\tresolve(t);\r\n\t\t\t\t\tfreeDynamic(dispose);\r\n\t\t\t\t});\r\n\t\t\t\trejectCall.set(this,e=>{\r\n\t\t\t\t\tresolveCall.delete(this);\r\n\t\t\t\t\trejectCall.delete(this);\r\n\t\t\t\t\tthis.finished=true;\r\n\t\t\t\t\treject(e instanceof RpcError?e.unfreeze(stackSource as any,skip):e);\r\n\t\t\t\t\tfreeDynamic(dispose);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tcatch<TResult=never>(onrejected?:((reason:any)=>(PromiseLike<TResult> | TResult)) | undefined | null):Promise<T | TResult>{\r\n\t\treturn this.promise.catch(onrejected);\r\n\t}\r\n\r\n\tfinally(onfinally?:(()=>void) | undefined | null):Promise<T>{\r\n\t\treturn this.promise.finally(onfinally);\r\n\t}\r\n\r\n\tthen<TResult1=T,TResult2=never>(onfulfilled?:((value:T)=>(PromiseLike<TResult1> | TResult1)) | undefined | null,onrejected?:((reason:any)=>(PromiseLike<TResult2> | TResult2)) | undefined | null):Promise<TResult1 | TResult2>{\r\n\t\treturn this.promise.then(onfulfilled,onrejected);\r\n\t}\r\n\r\n\tsendMessage(..._args:any[]):PendingCall<T>{//overridden by callFunction and callLocal\r\n\t\treturn this;\r\n\t}\r\n\r\n\taddMessageListener<Args extends any[]=any[]>(func:(...args:Args)=>void):PendingCall<T>{\r\n\t\treturn registerReceive(this,func as (...args:any[])=>void);\r\n\t}\r\n\r\n\tcancel(){}//overridden by callFunction and callLocal\r\n\t\r\n\tgetCaller():Promise<string>{\r\n\t\treturn Promise.resolve(Rpc.prettyName);\r\n\t}//overridden by callFunction and callLocal\r\n\r\n\t[Symbol.asyncIterator]():AsyncIterator<any[]>{\r\n\t\treturn getAsyncIterator(this);\r\n\t}\r\n}\r\n\r\nexport function getAsyncIterator(call:PendingCall | FunctionCallContext):AsyncIterator<unknown[]>{\r\n\tlet didReceive:IteratorResult<unknown[]>[]=[];\r\n\tlet waitReceive:((r:IteratorResult<unknown[]>)=>void)[]=[];\r\n\r\n\tcall.promise.catch(()=>{});\r\n\tcall.promise.finally(()=>{\r\n\t\tfor(let request of waitReceive) request({done:true,value:undefined});\r\n\t});\r\n\tcall.addMessageListener((...args)=>{\r\n\t\t(waitReceive.shift()??didReceive.push)({done:false,value:args});\r\n\t});\r\n\r\n\treturn {\r\n\t\tasync next():Promise<IteratorResult<unknown[]>>{\r\n\t\t\tif(call.finished) return {done:true,value:undefined};\r\n\t\t\treturn didReceive.shift()?? await new Promise(res=>waitReceive.push(res));\r\n\t\t},\r\n\t};\r\n}\r\n\r\nexport const resolveCall=new WeakMap<PendingCall,Action<any>>();\r\nexport const rejectCall=new WeakMap<PendingCall,Action<unknown>>();\r\nexport const pendingMap=new WeakMap<PendingCall | FunctionCallContext,(any[])[]>();\r\nexport const listenersMap=new WeakMap<PendingCall | FunctionCallContext,((...args:any[])=>void)[]>();\r\n\r\nexport function registerReceive<AnyCall extends PendingCall | FunctionCallContext>(call:AnyCall,func:(...args:any[])=>void){\r\n\tif(listenersMap.has(call)){\r\n\t\tlistenersMap.get(call)!.push(func);\r\n\t}else{\r\n\t\tlistenersMap.set(call,[func]);\r\n\t\tconst pendings=pendingMap.get(call)??[];\r\n\t\tfor(let pending of pendings){\r\n\t\t\ttry{\r\n\t\t\t\tfunc(...pending);\r\n\t\t\t}catch(e){\r\n\t\t\t\tconsole.warn(\"[Rpc] Error while handling pending message:\",e);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn call;\r\n}\r\n\r\nexport function runReceiveMessage(call:PendingCall | FunctionCallContext,args:any[]){\r\n\tif(call.finished) return;\r\n\r\n\tif(listenersMap.has(call)){\r\n\t\tfor(let func of listenersMap.get(call)!){\r\n\t\t\ttry{\r\n\t\t\t\tfunc(...args);\r\n\t\t\t}catch(e){\r\n\t\t\t\tconsole.warn(\"[Rpc] Error while receiving message:\",e);\r\n\t\t\t}\r\n\t\t}\r\n\t}else if(pendingMap.has(call)){\r\n\t\tpendingMap.set(call,[...pendingMap.get(call)!,args]);\r\n\t}else{\r\n\t\tpendingMap.set(call,[args]);\r\n\t}\r\n}","import {invoke,registeredTypes} from \"../../internal/RegisteredTypes.js\";\r\nimport {getAsyncIterator,PendingCall,registerReceive,rejectCall,resolveCall,runReceiveMessage} from \"./PendingCall.js\";\r\nimport {DataOutput} from \"../data/DataOutput.js\";\r\nimport {PacketType,sendCall,sendRaw} from \"../../connection/Connection.js\";\r\nimport {_webSocket,isConnected} from \"../../connection/WebSocketConnection.js\";\r\nimport {RpcError} from \"../RpcError.js\";\r\nimport {RpcConnectionError} from \"../errors/PredefinedErrors.js\";\r\n\r\n\r\nlet currentContext:FunctionCallContext | null=null;\r\n\r\nexport function runWithContext<T>(func:()=>T,context:FunctionCallContext):T{\r\n\tconst previous:FunctionCallContext | null=currentContext;\r\n\tcurrentContext=context;\r\n\ttry{\r\n\t\treturn func();\r\n\t}finally{\r\n\t\tcurrentContext=previous;\r\n\t}\r\n}\r\n\r\nexport function getFunctionContext():FunctionCallContext{\r\n\tif(currentContext==null) throw new Error(\"FunctionCallContext not available\");\r\n\treturn currentContext;\r\n}\r\n\r\n\r\nlet nextId=0;\r\n\r\nexport function callRemoteFunction<T=unknown>(type:string | null,method:string | null,...args:any[]):PendingCall<T>{\r\n\tif(type!=null){\r\n\t\tconst local=registeredTypes.get(type);\r\n\t\tif(local) return callLocalFunction<T>(invoke.bind(null,local,type,method,...args),type,method,args,3);\r\n\t}\r\n\r\n\tconst already:unknown[]=[];\r\n\tconst call=new PendingCall<T>(2,already);\r\n\r\n\tconst buff=new DataOutput();\r\n\tconst callId=nextId++;\r\n\ttry{\r\n\t\tbuff.writeByte(PacketType.FunctionCall);\r\n\t\tbuff.writeLength(callId);\r\n\t\tbuff.writeString(type);\r\n\t\tbuff.writeString(method);\r\n\t\tbuff.writeArray(args,d=>buff.writeDynamic(d,already));\r\n\t}catch(e){\r\n\t\trejectCall.get(call)?.(e);\r\n\t\treturn call;\r\n\t}\r\n\r\n\tif(!(isConnected||(type==null&&_webSocket!=null))){\r\n\t\trejectCall.get(call)?.(RpcConnectionError.new(\"Not connected\"));\r\n\t\treturn call;\r\n\t}\r\n\tcall.sendMessage=(...msgArgs)=>{\r\n\t\tif(call.finished) return call;\r\n\t\tconst msg=new DataOutput();\r\n\t\tmsg.writeByte(PacketType.MessageToExecutor);\r\n\t\tmsg.writeLength(callId);\r\n\t\tconst list:unknown[]=[];\r\n\t\tmsg.writeArray(msgArgs,d=>msg.writeDynamic(d,list));\r\n\t\talready.push(...list);\r\n\r\n\t\tsendRaw(msg);\r\n\t\treturn call;\r\n\t};\r\n\tcall.cancel=()=>{\r\n\t\tif(call.finished) return;\r\n\t\tconst msg=new DataOutput();\r\n\t\tmsg.writeByte(PacketType.FunctionCancel);\r\n\t\tmsg.writeLength(callId);\r\n\r\n\t\tsendRaw(msg);\r\n\t};\r\n\tcall.getCaller=()=>callRemoteFunction(null,\"c\",callId);\r\n\r\n\tsendCall(callId,call,buff);\r\n\r\n\treturn call;\r\n}\r\n\r\n\r\nexport function callLocal<T>(func:()=>(Promise<T> | T)):PendingCall<T>{\r\n\treturn callLocalFunction(func,null,null,null,3);\r\n}\r\n\r\nfunction callLocalFunction<T>(func:()=>(Promise<T> | T),type:string | null,method:string | null,args:any[] | null,skip:number){\r\n\tconst pending=new PendingCall<T>(skip,[]);\r\n\r\n\tconst controller=new AbortController();\r\n\tconst context:FunctionCallContext={\r\n\t\ttype,\r\n\t\tmethod,\r\n\t\tsendMessage:(...sending)=>{\r\n\t\t\tpending.finished||runReceiveMessage(pending,sending);\r\n\t\t\treturn context;\r\n\t\t},\r\n\t\tget finished(){\r\n\t\t\treturn pending.finished\r\n\t\t},\r\n\t\tpromise:pending,\r\n\t\taddMessageListener:(func:(...args:any[])=>void)=>registerReceive(context,func),\r\n\t\tcancelToken:controller.signal,\r\n\t\tcancelSelf:()=>controller.abort(),\r\n\t\t[Symbol.asyncIterator]:()=>getAsyncIterator(context),\r\n\t};\r\n\tpending.sendMessage=(...received)=>{\r\n\t\tpending.finished||runReceiveMessage(context,received);\r\n\t\treturn pending;\r\n\t};\r\n\tpending.cancel=()=>pending.finished||context.cancelSelf();\r\n\r\n\t// noinspection JSIgnoredPromiseFromCall\r\n\tinvokeForPromise(func,context,resolveCall.get(pending),rejectCall.get(pending),type,method,args);\r\n\r\n\treturn pending;\r\n}\r\n\r\nexport async function invokeForPromise<T>(func:()=>T,context:FunctionCallContext,resolve:((t:T)=>void) | undefined,reject:((e:RpcError)=>void) | undefined,\r\n\t\t\t\t\t\t\t\t\t\t  type:string | null,method:string | null,args:any[] | null){\r\n\ttry{\r\n\t\tlet result:Promise<T>;\r\n\t\tconst previous:FunctionCallContext | null=currentContext;\r\n\t\tcurrentContext=context;\r\n\t\ttry{\r\n\t\t\tresult=await (({\r\n\t\t\t\tasync $RPC_MARKER_BEGIN$(){\r\n\t\t\t\t\treturn await func() as any;\r\n\t\t\t\t}\r\n\t\t\t})[\"$RPC_MARKER_BEGIN$\"])();\r\n\t\t}finally{\r\n\t\t\tcurrentContext=previous;\r\n\t\t}\r\n\t\tresolve?.(await result);\r\n\t}catch(e){\r\n\t\treject?.(RpcError\r\n\t\t\t.wrapAndFreeze(e as Error)\r\n\t\t\t.append(type,method,args));\r\n\t}\r\n}\r\n\r\nexport interface FunctionCallContext{\r\n\treadonly type:string | null\r\n\treadonly method:string | null\r\n\treadonly finished:boolean\r\n\treadonly promise:Promise<unknown>\r\n\r\n\tsendMessage(...args:any[]):FunctionCallContext\r\n\r\n\taddMessageListener(func:(...args:any[])=>void):FunctionCallContext\r\n\r\n\tcancelToken:AbortSignal\r\n\r\n\tcancelSelf():void\r\n\r\n\t[Symbol.asyncIterator]():AsyncIterator<any[]>;\r\n}","import {RpcId} from \"../connection/RpcId.js\";\r\nimport {callRemoteFunction} from \"./functions/FunctionCallContext.js\";\r\nimport {PendingCall} from \"./functions/PendingCall.js\";\r\nimport {registeredFunctions} from \"../internal/RegisteredTypes.js\";\r\n\r\n\r\ntype ParamsOrEmpty<T>=T extends (...args: infer Params)=>any?Params: unknown extends T?any[]: [];\r\ntype ReturnTypeFromAnything<T>=T extends (...args: any)=>infer ReturnType?ReturnType: T;\r\ntype UnwrapPromise<T>=T extends Promise<infer PromiseType>?PromiseType: T;\r\n\r\nexport type RpcFunction<FuncOrReturnType>=InstanceType<typeof RpcFunction<FuncOrReturnType>>;\r\n\r\nexport const RpcFunction=class RpcFunction<FuncOrReturnType>\r\n\textends (function Extendable(func: Function){return Object.setPrototypeOf(func,new.target.prototype);} as any as {\r\n\t\tnew<FuncOrReturnType=unknown>(func: Function): {\r\n\t\t\t//Complex call signature from generic, to allow easier definition later on\r\n\t\t\t(...args: ParamsOrEmpty<FuncOrReturnType>): PendingCall<UnwrapPromise<ReturnTypeFromAnything<FuncOrReturnType>>>;\r\n\t\t}\r\n\t})<FuncOrReturnType>{\r\n\r\n\tconstructor(\r\n\t\tpublic readonly type: string,\r\n\t\tpublic readonly method: string,\r\n\t){super(callRemoteFunction.bind(null,type,method));}\r\n\r\n\r\n\ttoString(){\r\n\t\treturn `rpc (...params) => ${this.type??\"null\"}.${this.method}(...params)`;\r\n\t}\r\n};\r\n\r\nlet nextId: number=Date.now();\r\nconst functionCache=new WeakMap<((...args: any)=>any),string>();\r\n\r\nexport function registerFunction<T extends ((...args: any)=>any)>(func: T): RpcFunction<T>{\r\n\tif(func instanceof RpcFunction) return func;\r\n\tconst already=functionCache.get(func);\r\n\tif(already!=null)return new RpcFunction(\"$\"+RpcId,already);\r\n\tconst id=(nextId++).toString(16);\r\n\r\n\tregisteredFunctions[id]=func;\r\n\tfunctionCache.set(func,id);\r\n\r\n\tconst type=\"$\"+RpcId;\r\n\treturn new RpcFunction(type,id);\r\n}\r\n\r\nexport function unregisterFunction(func: RpcFunction<any>){\r\n\tconst type=\"$\"+RpcId;\r\n\tif(func.type!=type) throw new Error(\"Can't unregister RemoteFunction, that was not registered locally\");\r\n\r\n\tdelete registeredFunctions[func.method];\r\n\tfunctionCache.delete(func);\r\n}","import {RpcFunction} from \"./RpcFunction.js\";\r\nimport {callRemoteFunction} from \"./functions/FunctionCallContext.js\";\r\n\r\nexport const RpcObjectType=Symbol(\"RpcObjectType\");\r\nexport const RpcObjectExists=Symbol(\"RpcObjectExists\");\r\nexport const RpcObjectGetMethods=Symbol(\"RpcObjectGetMethods\");\r\nexport type RpcObject<T=RpcObjectTemplate,Type=string>={\r\n\t[x in keyof T]:\r\n\tx extends \"then\" | symbol?\r\n\t\tT[x]:\r\n\t\tT[x] extends (...args: any[])=>unknown?\r\n\t\t\tRpcFunction<T[x]>:\r\n\t\t\tRpcFunction<any>;\r\n} & {\r\n\t[RpcObjectType]: Type,\r\n\t[RpcObjectExists]: ()=>Promise<boolean>\r\n\t[RpcObjectGetMethods]: ()=>Promise<string[]>\r\n};\r\n\r\nexport type RpcObjectTemplate={\r\n\t[s: string]: (...args: any[])=>unknown\r\n}\r\n\r\n\r\nexport function createRemoteObject<\r\n\tT extends object=RpcObjectTemplate,\r\n\tTypeString extends string=string\r\n>(\r\n\ttype: TypeString,\r\n\ttarget: T=new class RpcObject{[RpcObjectType]=type} as T,\r\n): RpcObject<T,TypeString>{\r\n\t\r\n\tconst cache=new Map<string,RpcFunction<any>>();\r\n\t\r\n\t\r\n\treturn new Proxy<RpcObject<T,TypeString>>(<any>target,{\r\n\t\tget(_: never,p: string | symbol): any{\r\n\t\t\tif(p==RpcObjectType) return type;\r\n\t\t\tif(p==RpcObjectExists) return ()=>callRemoteFunction(null,\"E\",type);\r\n\t\t\tif(p==RpcObjectGetMethods) return ()=>callRemoteFunction(type,null,\"M\");\r\n\t\t\tif(typeof p!=\"string\"||\r\n\t\t\t\tp==\"then\"//otherwise every RemoteObject would be thenable => would interfere with async await\r\n\t\t\t) return (<any>target)[p];\r\n\t\t\tif(cache.has(p)) return cache.get(p);\r\n\r\n\t\t\tconst func=new RpcFunction(\r\n\t\t\t\ttype,\r\n\t\t\t\tp);\r\n\t\t\tcache.set(p,func);\r\n\t\t\treturn func;\r\n\t\t},\r\n\t\tconstruct(target: any,argArray: any[]): object{\r\n\t\t\treturn new target(...argArray);\r\n\t\t},\r\n\t\thas(_:never,p: string | symbol): boolean{\r\n\t\t\treturn p==RpcObjectType||p==RpcObjectGetMethods||p==RpcObjectExists||p in target;\r\n\t\t},\r\n\t});\r\n}\r\n\r\n\r\nexport const RPC_ROOT=new Proxy({},{\r\n\tget:(_,prop)=>typeof prop==\"string\"?createRemoteObject(prop):undefined,\r\n\thas:(_,prop)=>typeof prop==\"string\"&&prop!=\"then\",\r\n}) as Record<string,RpcObject>;","import {DataInput} from \"./DataInput.js\";\r\nimport {createRemoteObject,RpcObjectType} from \"../RpcObject.js\";\r\nimport {DataOutput} from \"./DataOutput.js\";\r\nimport {registerFunction,RpcFunction,unregisterFunction} from \"../RpcFunction.js\";\r\n\r\nexport const writeRegistry: [id: string,check: (d: unknown)=>boolean,write: (data: DataOutput,o: unknown,already: unknown[])=>void][]=[];\r\nexport const readRegistry=new Map<string,(data: DataInput,already: unknown[])=>unknown>();\r\n\r\nexport function readDynamic(data: DataInput,already: unknown[]){\r\n\tlet objectId=data.readLength();\r\n\r\n\tif(objectId<0){\r\n\t\tobjectId= -objectId;\r\n\t\tswitch(objectId%4){\r\n\t\t\tcase 0:\r\n\t\t\t\treturn already[objectId/4];\r\n\t\t\tcase 1:\r\n\t\t\t\treturn new TextDecoder().decode(data.readBuffer((objectId-1)/4));\r\n\t\t\tcase 2:{\r\n\t\t\t\tconst o: Record<string,any>={};\r\n\t\t\t\talready.push(o);\r\n\t\t\t\tfor(let i=0; i<(objectId-2)/4; i++){\r\n\t\t\t\t\tconst key=data.readString();\r\n\t\t\t\t\to[key!]=readDynamic(data,already);\r\n\t\t\t\t}\r\n\t\t\t\treturn o;\r\n\t\t\t}\r\n\t\t\tcase 3:{\r\n\t\t\t\tconst o=new Array((objectId-3)/4);\r\n\t\t\t\talready.push(o);\r\n\t\t\t\tfor(let i=0; i<o.length; i++) o[i]=readDynamic(data,already);\r\n\t\t\t\treturn o;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthrow new Error(\"Unreachable code reached\");\r\n\t}else if(objectId>=128){\r\n\t\tconst type=new TextDecoder().decode(data.readBuffer(objectId-128));\r\n\t\tconst registryEntry=readRegistry.get(type);\r\n\t\tif(registryEntry)\r\n\t\t\treturn registryEntry(data,already);\r\n\t\tthrow new Error(\"Unknown data type: \"+type);\r\n\t}else{\r\n\t\tswitch(String.fromCodePoint(objectId)){\r\n\t\t\tcase 'n':\r\n\t\t\t\treturn null;\r\n\t\t\tcase 't':\r\n\t\t\t\treturn true;\r\n\t\t\tcase 'f':\r\n\t\t\t\treturn false;\r\n\t\t\tcase 'i':\r\n\t\t\t\treturn data.readInt();\r\n\t\t\tcase 'd':\r\n\t\t\t\treturn data.readDouble();\r\n\t\t\tcase 'l':\r\n\t\t\t\treturn data.readLong();\r\n\t\t\tcase 'b':\r\n\t\t\t\treturn data.readBuffer(data.readLength());\r\n\t\t\tcase 'D':\r\n\t\t\t\treturn new Date(Number(data.readLong()));\r\n\t\t\tcase 'R':{\r\n\t\t\t\tconst pattern=data.readString();\r\n\t\t\t\tconst flags=data.readByte();\r\n\r\n\t\t\t\treturn new RegExp(pattern!,\"g\"+\r\n\t\t\t\t\t((flags&1)?\"i\": \"\")+\r\n\t\t\t\t\t((flags&2)?\"m\": \"\"),\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tcase 'E':\r\n\t\t\t\treturn data.readError();\r\n\t\t\tcase 'O':\r\n\t\t\t\tconst objectType=data.readString();\r\n\t\t\t\tif(objectType==null) throw new Error(\"Type can't be null\");\r\n\t\t\t\treturn createRemoteObject(objectType);\r\n\t\t\tcase 'F':\r\n\t\t\t\tconst type=data.readString();\r\n\t\t\t\tif(type==null) throw new Error(\"Type can't be null\");\r\n\t\t\t\tconst method=data.readString();\r\n\t\t\t\tif(method==null) throw new Error(\"Method can't be null\");\r\n\t\t\t\tconst func=new RpcFunction(type,method);\r\n\t\t\t\talready.push(func);\r\n\t\t\t\treturn func;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(\"Unknown data type number: \"+objectId);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function writeDynamic(output: DataOutput,d: unknown,already: unknown[]){\r\n\tif(d==null) output.writeLength('n'.charCodeAt(0));\r\n\telse if(d===true) output.writeLength('t'.charCodeAt(0));\r\n\telse if(d===false) output.writeLength('f'.charCodeAt(0));\r\n\telse if(typeof d==\"number\"&&(d|0)===d){\r\n\t\toutput.writeLength('i'.charCodeAt(0));\r\n\t\toutput.writeInt(d);\r\n\t}else if(typeof d==\"number\"){\r\n\t\toutput.writeLength('d'.charCodeAt(0));\r\n\t\toutput.writeDouble(d);\r\n\t}else if(typeof d==\"bigint\"){\r\n\t\toutput.writeLength('l'.charCodeAt(0));\r\n\t\toutput.writeLong(d);\r\n\t}else if(d instanceof Uint8Array){\r\n\t\toutput.writeLength('b'.charCodeAt(0));\r\n\t\toutput.writeLength(d.length);\r\n\t\toutput.writeBuffer(d);\r\n\t}else if(d instanceof Date){\r\n\t\toutput.writeLength('D'.charCodeAt(0));\r\n\t\toutput.writeLong(+d);\r\n\t}else if(d instanceof RegExp){\r\n\t\toutput.writeLength('R'.charCodeAt(0));\r\n\t\toutput.writeString(d.source);\r\n\t\tconst flags=d.flags;\r\n\t\toutput.writeByte(\r\n\t\t\t(flags.includes(\"i\")?1: 0)||\r\n\t\t\t(flags.includes(\"m\")?2: 0),\r\n\t\t);\r\n\t}else if(d instanceof Error){\r\n\t\toutput.writeLength('E'.charCodeAt(0));\r\n\t\toutput.writeError(d);\r\n\t}else if(typeof d===\"object\"&&RpcObjectType in d){//RpcObject\r\n\t\toutput.writeLength('O'.charCodeAt(0));\r\n\t\toutput.writeString((d as any)[RpcObjectType]);\r\n\t}else if(typeof d===\"function\"){//RpcFunction\r\n\t\talready.push(d);\r\n\t\toutput.writeLength('F'.charCodeAt(0));\r\n\t\t\r\n\t\tlet rpcFunc:RpcFunction<any>;\r\n\t\tif(d instanceof RpcFunction)rpcFunc=d;\r\n\t\telse{\r\n\t\t\trpcFunc=registerFunction(d as any);\r\n\t\t\tonFree.set(d,()=>unregisterFunction(rpcFunc));\r\n\t\t}\r\n\r\n\t\toutput.writeString(rpcFunc.type);\r\n\t\toutput.writeString(rpcFunc.method);\r\n\t\t\r\n\t}else if(already.includes(d)){\r\n\t\toutput.writeLength(-(already.indexOf(d)*4/* +0 */));\r\n\t}else if(typeof d===\"string\"){\r\n\t\tconst buffer=new TextEncoder().encode(d);\r\n\t\toutput.writeLength(-(buffer.length*4+1));\r\n\t\toutput.writeBytes(buffer);\r\n\t} else if(Array.isArray(d)){\r\n\t\talready.push(d);\r\n\t\toutput.writeLength(-(d.length*4+3));\r\n\t\tfor(let element of d) writeDynamic(output,element,already);\r\n\t}else{\r\n\t\tfor(let [id,check,write] of writeRegistry){\r\n\t\t\tif(!check(d)) continue;\r\n\t\t\tconst idBytes=new TextEncoder().encode(id);\r\n\t\t\toutput.writeLength(idBytes.length+128);\r\n\t\t\toutput.writeBytes(idBytes);\r\n\t\t\twrite(output,d,already);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(typeof d===\"object\"){\r\n\t\t\talready.push(d);\r\n\t\t\tconst entries=Object.entries(d);\r\n\t\t\toutput.writeLength(-(entries.length*4+2));\r\n\t\t\tfor(let [key,value] of entries){\r\n\t\t\t\toutput.writeString(key);\r\n\t\t\t\twriteDynamic(output,value,already);\r\n\t\t\t}\r\n\t\t}else throw new Error(\"Unknown type for \"+d);\r\n\t}\r\n}\r\n\r\nconst onFree=new WeakMap<any,VoidFunction>();\r\nexport function freeDynamic(already:unknown[]){\r\n\tfor(let element of already)\r\n\t\tonFree.get(element)?.();\r\n}","import {RpcError} from \"../RpcError.js\";\r\nimport {writeDynamic} from \"./DynamicData.js\";\r\n\r\n// noinspection JSUnusedGlobalSymbols\r\nexport class DataOutput{\r\n\tprivate _buf:Uint8Array;\r\n\tprivate _data:DataView;\r\n\tprivate _count:number=0;\r\n\r\n\tconstructor(size:number | Uint8Array=32){\r\n\t\tthis._buf=typeof size===\"number\"?new Uint8Array(size):size;\r\n\t\tthis._data=new DataView(this._buf.buffer);\r\n\t}\r\n\r\n\tprivate ensureCapacity(additional:number){\r\n\t\tadditional+=this._count;\r\n\t\tif(additional>this._buf.byteLength){\r\n\t\t\tlet replacement=new Uint8Array(Math.max(this._buf.byteLength*2,additional));\r\n\t\t\tthis._data=new DataView(replacement.buffer);\r\n\r\n\t\t\treplacement.set(this._buf);\r\n\t\t\tthis._buf=replacement;\r\n\t\t}\r\n\t}\r\n\r\n\twriteByte(b:number):void{\r\n\t\tthis.ensureCapacity(1);\r\n\t\tthis._buf[this._count]=b;\r\n\t\tthis._count++;\r\n\t}\r\n\r\n\twriteBytes(b:ArrayLike<number>):void{\r\n\t\tthis.ensureCapacity(b.length);\r\n\t\tthis._buf.set(b,this._count);\r\n\t\tthis._count+=b.length;\r\n\t}\r\n\r\n\twriteBuffer(buf:Uint8Array):void{\r\n\t\tthis.writeBytes(buf);\r\n\t}\r\n\r\n\twriteBoolean(b:boolean):void{\r\n\t\tthis.writeByte(b?1:0);\r\n\t}\r\n\r\n\twriteNullBoolean(b:boolean | null):void{\r\n\t\tthis.writeByte(b==null?2:b?1:0);\r\n\t}\r\n\r\n\twriteShort(n:number):void{\r\n\t\tthis.ensureCapacity(2);\r\n\t\tthis._data.setInt16(this._count,n);\r\n\t\tthis._count+=2;\r\n\t}\r\n\r\n\twriteChar(c:string):void{\r\n\t\tthis.writeShort(c.charCodeAt(0));\r\n\t}\r\n\r\n\twriteInt(n:number):void{\r\n\t\tthis.ensureCapacity(4);\r\n\t\tthis._data.setInt32(this._count,n);\r\n\t\tthis._count+=4;\r\n\t}\r\n\r\n\twriteLong(n:bigint | number):void{\r\n\t\tif(typeof n===\"number\"){\r\n\t\t\tthis.writeInt(n/(2**32));\r\n\t\t\tthis.writeInt(n%(2**32));\r\n\t\t}else{\r\n\t\t\tthis.writeInt(Number(n/BigInt(2**32)));\r\n\t\t\tthis.writeInt(Number(n%BigInt(2**32)));\r\n\t\t}\r\n\t}\r\n\r\n\twriteFloat(n:number):void{\r\n\t\tthis.ensureCapacity(4);\r\n\t\tthis._data.setFloat32(this._count,n);\r\n\t\tthis._count+=4;\r\n\t}\r\n\r\n\twriteDouble(n:number):void{\r\n\t\tthis.ensureCapacity(8);\r\n\t\tthis._data.setFloat64(this._count,n);\r\n\t\tthis._count+=8;\r\n\t}\r\n\r\n\twriteString(s:string | null){\r\n\t\tif(s==null){\r\n\t\t\tthis.writeLength(-1);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet array=new TextEncoder().encode(s);\r\n\t\tthis.writeLength(array.length);\r\n\t\tthis.writeBytes(array);\r\n\t}\r\n\r\n\twriteLength(i:number){\r\n\t\tlet u=(i<0?~i:i)>>>0;// \">>>0\" : convert to unsigned\r\n\t\twhile(u>=0x80){\r\n\t\t\tthis.writeByte(u|0x80);\r\n\t\t\tu>>=7;\r\n\t\t}\r\n\t\tif(i<0){\r\n\t\t\tthis.writeByte(u|0x80);\r\n\t\t\tthis.writeByte(0);\r\n\t\t}else{\r\n\t\t\tthis.writeByte(u);\r\n\t\t}\r\n\t}\r\n\r\n\twriteByteArray(arr:ArrayLike<number> | null){\r\n\t\tif(!arr) this.writeLength(-1);\r\n\t\telse{\r\n\t\t\tthis.writeLength(arr.length);\r\n\t\t\tthis.writeBytes(arr);\r\n\t\t}\r\n\t}\r\n\r\n\twriteArray<T>(arr:ArrayLike<T> | null,writeFunction:(t:T)=>void){\r\n\t\tif(!arr) this.writeLength(-1);\r\n\t\telse{\r\n\t\t\tthis.writeLength(arr.length);\r\n\t\t\tfor(let i=0; i<arr.length; i++)\r\n\t\t\t\twriteFunction.call(this,arr[i]!);\r\n\t\t}\r\n\t}\r\n\r\n\ttoBuffer(from=0):Uint8Array{\r\n\t\treturn this._buf.slice(from,this._count-from);\r\n\t}\r\n\r\n\twriteError(error:Error){\r\n\t\ttry{// noinspection ExceptionCaughtLocallyJS\r\n\t\t\tthrow RpcError.wrapAndFreeze(error)\r\n\t\t}catch(e){\r\n\t\t\t(e as RpcError).write(this);\r\n\t\t}\r\n\t}\r\n\r\n\twriteDynamic(value:any,already:unknown[]=[]){\r\n\t\twriteDynamic(this,value,already);\r\n\t}\r\n}\r\n","// noinspection ExceptionCaughtLocallyJS\r\n\r\nimport {_webSocket} from \"./WebSocketConnection.js\";\r\nimport {DataOutput} from \"../types/data/DataOutput.js\";\r\nimport {DataInput} from \"../types/data/DataInput.js\";\r\nimport {\r\n\tgetAsyncIterator,\r\n\tPendingCall,\r\n\tregisterReceive,\r\n\trejectCall,\r\n\tresolveCall,\r\n\trunReceiveMessage,\r\n} from \"../types/functions/PendingCall.js\";\r\nimport {invoke,registeredTypes} from \"../internal/RegisteredTypes.js\";\r\nimport {FunctionCallContext,invokeForPromise} from \"../types/functions/FunctionCallContext.js\";\r\nimport {freeDynamic} from \"../types/data/DynamicData.js\";\r\nimport {RpcConnectionError,RpcDataError,RpcError,RpcTypeNotFoundError} from \"../rpc.js\";\r\n\r\n\r\nconst activeRequests=new Map<number,PendingCall>();\r\nconst currentlyExecuting=new Map<number,FunctionCallContext>();\r\n\r\nexport function disposeConnection(e:Error){\r\n\tfor(let pending of activeRequests.values()) rejectCall.get(pending)?.(e);\r\n\tactiveRequests.clear();\r\n\r\n\tfor(let ctx of currentlyExecuting.values()) ctx.cancelSelf();\r\n}\r\n\r\nexport function sendRaw(buff:DataOutput){\r\n\tif(_webSocket==null) throw RpcConnectionError.new(\"Not connected\");\r\n\t_webSocket.send(buff.toBuffer());\r\n}\r\n\r\nexport function sendCall(callId:number,call:PendingCall,buff:DataOutput){\r\n\tactiveRequests.set(callId,call);\r\n\ttry{\r\n\t\tsendRaw(buff);\r\n\t}catch(e){\r\n\t\trejectCall.get(call)?.(e);\r\n\t}\r\n}\r\n\r\nexport enum PacketType{\r\n\tFunctionCall=0,\r\n\tFunctionSuccess=1,\r\n\tFunctionError=2,\r\n\tFunctionCancel=3,\r\n\tMessageToExecutor=4,\r\n\tMessageToCaller=5,\r\n}\r\n\r\nexport async function receiveRpc(data:DataInput){\r\n\tconst packetType=data.readByte() as PacketType;\r\n\r\n\tswitch(packetType){\r\n\t\tcase PacketType.FunctionCall:{\r\n\t\t\tconst callId=data.readLength();\r\n\r\n\r\n\t\t\tconst already:unknown[]=[];\r\n\r\n\t\t\tlet finished:boolean=false;\r\n\t\t\tlet resolve:(t:unknown)=>void=null!;\r\n\t\t\tlet reject:(e:Error)=>void=null!;\r\n\r\n\t\t\tconst promise=new Promise((res,rej)=>{\r\n\t\t\t\tresolve=t=>{\r\n\t\t\t\t\tres(t);\r\n\t\t\t\t\tfinished=true;\r\n\r\n\t\t\t\t\tconst buff=new DataOutput();\r\n\t\t\t\t\tbuff.writeByte(PacketType.FunctionSuccess);\r\n\t\t\t\t\tbuff.writeLength(callId);\r\n\t\t\t\t\tbuff.writeDynamic(t);\r\n\t\t\t\t\tsendRaw(buff);\r\n\t\t\t\t\tcurrentlyExecuting.delete(callId);\r\n\r\n\t\t\t\t\tfreeDynamic(already);\r\n\t\t\t\t};\r\n\t\t\t\treject=e=>{\r\n\t\t\t\t\trej(e);\r\n\t\t\t\t\tfinished=true;\r\n\r\n\t\t\t\t\tconst buff=new DataOutput();\r\n\t\t\t\t\tbuff.writeByte(PacketType.FunctionError);\r\n\t\t\t\t\tbuff.writeLength(callId);\r\n\t\t\t\t\tbuff.writeError(e);\r\n\t\t\t\t\tsendRaw(buff);\r\n\t\t\t\t\tcurrentlyExecuting.delete(callId);\r\n\r\n\t\t\t\t\tfreeDynamic(already);\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tpromise.catch(()=>{});//Prevent uncaught error warning\r\n\r\n\r\n\t\t\ttry{\r\n\t\t\t\tconst type=data.readString();\r\n\r\n\t\t\t\tif(type==null)\r\n\t\t\t\t\tthrow RpcTypeNotFoundError.new(null);\r\n\t\t\t\tconst local=registeredTypes.get(type);\r\n\t\t\t\tif(!local)\r\n\t\t\t\t\tthrow RpcTypeNotFoundError.new(type);\r\n\r\n\t\t\t\tconst method=data.readString();\r\n\r\n\t\t\t\tconst args=data.readArray(()=>data.readDynamic(already))??[];\r\n\r\n\r\n\t\t\t\tconst controller=new AbortController();\r\n\t\t\t\tconst context:FunctionCallContext={\r\n\t\t\t\t\ttype,\r\n\t\t\t\t\tmethod,\r\n\t\t\t\t\tget finished(){\r\n\t\t\t\t\t\treturn finished;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tpromise,\r\n\t\t\t\t\tsendMessage(...sending){\r\n\t\t\t\t\t\tif(finished) return context;\r\n\t\t\t\t\t\tconst msg=new DataOutput();\r\n\t\t\t\t\t\tmsg.writeByte(PacketType.MessageToCaller);\r\n\t\t\t\t\t\tmsg.writeLength(callId);\r\n\t\t\t\t\t\tconst list:unknown[]=[];\r\n\t\t\t\t\t\tmsg.writeArray(sending,d=>msg.writeDynamic(d,list));\r\n\t\t\t\t\t\talready.push(...list);\r\n\r\n\t\t\t\t\t\tsendRaw(msg);\r\n\t\t\t\t\t\treturn context;\r\n\t\t\t\t\t},\r\n\t\t\t\t\taddMessageListener(func:(...args:any[])=>void){\r\n\t\t\t\t\t\tregisterReceive(context,func);\r\n\t\t\t\t\t\treturn context;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcancelToken:controller.signal,\r\n\t\t\t\t\tcancelSelf:()=>controller.abort(),\r\n\t\t\t\t\t[Symbol.asyncIterator]:()=>getAsyncIterator(context),\r\n\t\t\t\t};\r\n\t\t\t\tcurrentlyExecuting.set(callId,context);\r\n\r\n\r\n\t\t\t\tawait invokeForPromise(invoke.bind(null,local,type,method,...args),context,resolve,reject,type,method,args);\r\n\t\t\t}catch(e){\r\n\t\t\t\tif(!(e instanceof RpcError))\r\n\t\t\t\t\te=RpcDataError.new(`Error reading binary stream (${PacketType[packetType]})`,e as Error);\r\n\t\t\t\treject(e as Error);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase PacketType.FunctionSuccess:{\r\n\t\t\tconst callId=data.readLength();\r\n\r\n\t\t\tconst pending=activeRequests.get(callId);\r\n\t\t\tif(pending==null){\r\n\t\t\t\tconsole.warn(`[Rpc] No activeRequest[${callId}] (${PacketType[packetType]})`);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\ttry{\r\n\t\t\t\tresolveCall.get(pending)?.(data.readDynamic());\r\n\t\t\t}catch(e){\r\n\t\t\t\trejectCall.get(pending)?.(RpcDataError.new(`Error reading binary stream (${PacketType[packetType]})`,e as Error));\r\n\t\t\t}finally{\r\n\t\t\t\tactiveRequests.delete(callId);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase PacketType.FunctionError:{\r\n\t\t\tconst callId=data.readLength();\r\n\r\n\t\t\tconst pending=activeRequests.get(callId);\r\n\t\t\tif(pending==null){\r\n\t\t\t\tconsole.warn(`[Rpc] No activeRequest[${callId}] (${PacketType[packetType]})`);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\ttry{\r\n\t\t\t\tlet err:Error;\r\n\t\t\t\ttry{\r\n\t\t\t\t\terr=data.readError();\r\n\t\t\t\t}catch(e){\r\n\t\t\t\t\terr=RpcDataError.new(`Error reading binary stream (${PacketType[packetType]})`,e as Error)\r\n\t\t\t\t}\r\n\t\t\t\tthrow err;\r\n\t\t\t}catch(e){\r\n\t\t\t\trejectCall.get(pending)?.(e);\r\n\t\t\t}finally{\r\n\t\t\t\tactiveRequests.delete(callId);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase PacketType.FunctionCancel:{\r\n\t\t\tconst callId=data.readLength();\r\n\t\t\tlet ctx=currentlyExecuting.get(callId);\r\n\t\t\tif(!ctx){\r\n\t\t\t\tconsole.warn(`[Rpc] No currentlyExecuting[${callId}] (${PacketType[packetType]})`);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tctx.cancelSelf();\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase PacketType.MessageToExecutor:{\r\n\t\t\tconst callId=data.readLength();\r\n\t\t\tlet ctx=currentlyExecuting.get(callId);\r\n\t\t\tif(!ctx){\r\n\t\t\t\tconsole.warn(`[Rpc] No currentlyExecuting[${callId}] (${PacketType[packetType]})`);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tconst already:unknown[]=[];\r\n\t\t\tconst args=data.readArray(()=>data.readDynamic(already))??[];\r\n\t\t\trunReceiveMessage(ctx,args);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase PacketType.MessageToCaller:{\r\n\t\t\tconst callId=data.readLength();\r\n\t\t\tlet pending=activeRequests.get(callId);\r\n\t\t\tif(!pending){\r\n\t\t\t\tconsole.warn(`[Rpc] No activeRequest[${callId}] (${PacketType[packetType]})`);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tconst already:unknown[]=[];\r\n\t\t\tconst args=data.readArray(()=>data.readDynamic(already))??[];\r\n\t\t\trunReceiveMessage(pending,args);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n}","import {RpcError} from \"../RpcError.js\";\r\nimport {readDynamic} from \"./DynamicData.js\";\r\n\r\n// noinspection JSUnusedGlobalSymbols\r\nexport class DataInput{\r\n\tprivate readonly _buf: Uint8Array;\r\n\tprivate readonly _data: DataView;\r\n\tprivate _pos: number;\r\n\tprivate readonly _count: number;\r\n\r\n\tconstructor(buf: Uint8Array);\r\n\tconstructor(buf: Uint8Array,pos: number,length: number);\r\n\tconstructor(buf: Uint8Array,pos: number=0,length: number=buf.length){\r\n\t\tthis._buf=buf;\r\n\t\tthis._data=new DataView(buf.buffer);\r\n\t\tthis._pos=pos;\r\n\t\tthis._count=pos+length;\r\n\t}\r\n\r\n\treadFully(b: number[],off: number=0,len: number=b.length): void{\r\n\t\tlet pos=this._pos;\r\n\t\tconst available=this._count-pos;\r\n\r\n\t\tif(available<len) throw new RangeError(\"not enough bytes available to use readFully\");\r\n\r\n\t\tfor(let i=off; i<off+len; i++)\r\n\t\t\tb[i]=this._buf[pos++]!;\r\n\t\tthis._pos=pos;\r\n\t}\r\n\r\n\tskip(n: number): number{\r\n\t\tlet k=this.available();\r\n\t\tif(n<k) k=n<0?0: n;\r\n\t\tthis._pos+=k;\r\n\t\treturn k;\r\n\t}\r\n\r\n\tavailable(): number{\r\n\t\treturn this._count-this._pos;\r\n\t}\r\n\r\n\treadAll(): Uint8Array{\r\n\t\treturn this._buf.slice(this._pos,this._pos=this._count);\r\n\t}\r\n\r\n\treadBuffer(length: number): Uint8Array{\r\n\t\tif(length>this.available()) throw new RangeError();\r\n\t\treturn this._buf.slice(this._pos,this._pos+=length);\r\n\t}\r\n\r\n\treadByte(): number{\r\n\t\treturn this._data.getUint8(this._pos++);\r\n\t}\r\n\r\n\treadBoolean(): boolean{\r\n\t\treturn this.readByte()!=0;\r\n\t}\r\n\r\n\treadNullBoolean(): boolean | null{\r\n\t\tconst b=this.readByte();\r\n\t\treturn b<2?b==1: null;\r\n\t}\r\n\r\n\treadShort(): number{\r\n\t\tconst n=this._data.getInt16(this._pos);\r\n\t\tthis._pos+=2;\r\n\t\treturn n;\r\n\t}\r\n\r\n\treadUShort(): number{\r\n\t\tconst n=this._data.getUint16(this._pos);\r\n\t\tthis._pos+=2;\r\n\t\treturn n;\r\n\t}\r\n\r\n\treadChar(): string{\r\n\t\treturn String.fromCharCode(this.readUShort());\r\n\t}\r\n\r\n\treadInt(): number{\r\n\t\tconst n=this._data.getInt32(this._pos);\r\n\t\tthis._pos+=4;\r\n\t\treturn n;\r\n\t}\r\n\r\n\treadLong(): bigint{\r\n\t\treturn BigInt(this.readInt())*BigInt(2**32)+BigInt(this.readInt()>>>0);\r\n\t}\r\n\r\n\treadFloat(): number{\r\n\t\tconst n=this._data.getFloat32(this._pos);\r\n\t\tthis._pos+=4;\r\n\t\treturn n;\r\n\t}\r\n\r\n\treadDouble(): number{\r\n\t\tconst n=this._data.getFloat64(this._pos);\r\n\t\tthis._pos+=8;\r\n\t\treturn n;\r\n\t}\r\n\r\n\treadString(): string|null{\r\n\t\tlet length=this.readLength();\r\n\t\tif(length== -1) return null;\r\n\t\treturn new TextDecoder().decode(this.readBuffer(length));\r\n\t}\r\n\r\n\treadLength(): number{\r\n\t\tlet result=0;\r\n\t\tlet push=0;\r\n\t\twhile(true){\r\n\t\t\tconst read=this.readByte();\r\n\t\t\tif(read==0) return push==0?0: ~result;\r\n\t\t\tif((read&0x80)==0){\r\n\t\t\t\tresult|=read<<push;\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t\tresult|=(read&0x7f)<<push;\r\n\t\t\tpush+=7;\r\n\t\t}\r\n\t}\r\n\r\n\treadArray<T>(readFunction: ()=>T): T[]|null{\r\n\t\tconst length=this.readLength();\r\n\t\tif(length== -1) return null;\r\n\t\tconst arr: T[]=[];\r\n\t\tfor(let i=0; i<length; i++)\r\n\t\t\tarr[i]=readFunction.call(this);\r\n\t\treturn arr;\r\n\t}\r\n\r\n\treadError(){\r\n\t\treturn RpcError.read(this);\r\n\t}\r\n\r\n\treadDynamic(already: unknown[]=[]){\r\n\t\treturn readDynamic(this,already);\r\n\t}\r\n}","import {RpcName} from \"./RpcName.js\";\r\nimport {disposeConnection,receiveRpc} from \"./Connection.js\";\r\nimport {DataInput} from \"../types/data/DataInput.js\";\r\nimport {callRemoteFunction} from \"../types/functions/FunctionCallContext.js\";\r\nimport {registeredTypes} from \"../internal/RegisteredTypes.js\";\r\nimport {isNodeJs,RpcId} from \"./RpcId.js\";\r\nimport {RpcConnectionError} from \"../types/errors/PredefinedErrors.js\";\r\nimport {Rpc} from \"../rpc.js\";\r\n\r\n\r\nexport let isConnected=false;\r\n\r\n\r\nlet resolveWaitUntilConnected:VoidFunction,rejectWaitUntilConnected:(e:Error)=>void;\r\nlet waitUntilConnectedAttempt=new Promise<void>((res,rej)=>[resolveWaitUntilConnected,rejectWaitUntilConnected]=[res,rej]);\r\nwaitUntilConnectedAttempt.catch(()=>{});//Prevent uncaught error warning\r\n\r\nexport async function waitConnected(){\r\n\twhile(true)\r\n\t\tif(await waitUntilConnectedAttempt.then(()=>true,()=>false))\r\n\t\t\treturn;\r\n}\r\n\r\nlet createWebSocket:(query:URLSearchParams)=>Promise<WebSocket>;\r\nif(isNodeJs){\r\n\tconst RPC_URL=\"RPC_URL\" in globalThis?(globalThis as any)[\"RPC_URL\"]:process.env.RPC_URL;\r\n\tconst RPC_TOKEN=\"RPC_TOKEN\" in globalThis?(globalThis as any)[\"RPC_TOKEN\"]:process.env.RPC_TOKEN;\r\n\tif(!RPC_URL){\r\n\t\tconsole.warn(\"[Rpc] RPC_URL is not defined => RPC will not connect\");\r\n\t\tcreateWebSocket=async()=>({} as any as WebSocket);\r\n\t}else\r\n\t\tcreateWebSocket=async(query)=>{\r\n\t\t\tconst uri=new URL(RPC_URL);\r\n\t\t\turi.search=query.toString();\r\n\t\t\tconst ws:typeof import(\"ws\").WebSocket=\"require\" in globalThis?globalThis[\"require\"](\"ws\"):(await import(\"ws\")).WebSocket;\r\n\r\n\t\t\treturn new ws(uri,RPC_TOKEN==null?{}:{\r\n\t\t\t\theaders:{\r\n\t\t\t\t\tCookie:\"RPC_TOKEN=\"+RPC_TOKEN,\r\n\t\t\t\t},\r\n\t\t\t}) as unknown as WebSocket;\r\n\t\t};\r\n}else if(\"document\" in globalThis)\r\n\tcreateWebSocket=async(query)=>new WebSocket(\"ws\"+document.location.origin.substring(4)+\"/rpc?\"+query);\r\nelse{//Unknown Platform\r\n\tconst RPC_URL=\"RPC_URL\" in globalThis?(globalThis as any)[\"RPC_URL\"]:process.env.RPC_URL;\r\n\tconst RPC_TOKEN=\"RPC_TOKEN\" in globalThis?(globalThis as any)[\"RPC_TOKEN\"]:process.env.RPC_TOKEN;\r\n\tif(!RPC_URL){\r\n\t\tconsole.warn(\"[Rpc] RPC_URL is not defined => RPC will not connect\");\r\n\t\tcreateWebSocket=async()=>({} as any as WebSocket);\r\n\t}else\r\n\t\tcreateWebSocket=async(query)=>{\r\n\t\t\tconst uri=new URL(RPC_URL);\r\n\t\t\turi.search=query.toString();\r\n\t\t\treturn new WebSocket(uri,RPC_TOKEN==null?{}:{\r\n\t\t\t\theaders:{\r\n\t\t\t\t\tCookie:\"RPC_TOKEN=\"+RPC_TOKEN,\r\n\t\t\t\t},\r\n\t\t\t} as any) as unknown as WebSocket;\r\n\t\t};\r\n}\r\n\r\n\r\nfunction closeRpc(e:Error){\r\n\tconst reject=rejectWaitUntilConnected;\r\n\twaitUntilConnectedAttempt=new Promise<void>((res,rej)=>[resolveWaitUntilConnected,rejectWaitUntilConnected]=[res,rej]);\r\n\twaitUntilConnectedAttempt.catch(()=>{});//Prevent uncaught error warning\r\n\treject(e);\r\n\r\n\tdisposeConnection(e);\r\n}\r\n\r\n\r\n//connect\r\n\r\n\r\nexport let _webSocket:WebSocket | null=null;\r\n\r\n\r\nexport async function connectOnce(reconnect:VoidFunction){\r\n\tlet reportedName=RpcName;\r\n\tlet reportedTypes=new Set<string>();\r\n\r\n\tconst query=new URLSearchParams();\r\n\tquery.set(\"id\",RpcId);\r\n\treportedTypes.add(\"$\"+RpcId);\r\n\r\n\tif(reportedName!=null)\r\n\t\tquery.set(\"name\",reportedName);\r\n\r\n\tfor(let key of registeredTypes.keys())\r\n\t\tif(!reportedTypes.has(key)){\r\n\t\t\treportedTypes.add(key);\r\n\t\t\tquery.append(\"type\",key);\r\n\t\t}\r\n\r\n\r\n\tconst webSocket=await createWebSocket(query);\r\n\r\n\twebSocket.onclose=()=>{\r\n\t\tsetTimeout(reconnect,1000);\r\n\r\n\t\tif(!_webSocket) return;\r\n\t\t_webSocket=null;\r\n\t\tisConnected=false;\r\n\t\tconsole.info(\"[Rpc] Reconnecting to RPC\");\r\n\t\tcloseRpc(RpcConnectionError.new(\"Connection closed by \"+Rpc.prettyName));\r\n\t};\r\n\twebSocket.onopen=async()=>{\r\n\t\tconsole.info(\"[Rpc] Connected to RPC\");\r\n\r\n\t\ttry{\r\n\t\t\t_webSocket=webSocket;\r\n\r\n\t\t\tconst toRegister=new Set(registeredTypes.keys());\r\n\t\t\tconst toDelete=new Set(reportedTypes);\r\n\r\n\t\t\tfor(let type of toRegister)\r\n\t\t\t\tif(toDelete.delete(type))\r\n\t\t\t\t\ttoRegister.delete(type);\r\n\r\n\t\t\tif(toRegister.size||toDelete.size)\r\n\t\t\t\tif(RpcName!=reportedName) await callRemoteFunction(null,\"H\",RpcName,[...toRegister.keys()],[...toDelete.keys()]);\r\n\t\t\t\telse await callRemoteFunction(null,\"H\",[...toRegister.keys()],[...toDelete.keys()]);\r\n\t\t\telse if(RpcName!=reportedName) await callRemoteFunction(null,\"H\",RpcName);\r\n\r\n\t\t\tisConnected=true;\r\n\t\t\tresolveWaitUntilConnected();\r\n\r\n\t\t\t// @ts-ignore\r\n\t\t}catch(e:Error){\r\n\t\t\tconsole.error(\"[Rpc] Error connecting to RPC: \",e);\r\n\t\t\tcloseRpc(e);\r\n\r\n\t\t\twebSocket?.close(4000,\"Error registering types\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t};\r\n\r\n\twebSocket.binaryType=\"arraybuffer\";\r\n\twebSocket.onmessage=(e:MessageEvent)=>{\r\n\t\tconst data=e.data;\r\n\t\tif(typeof data==\"string\") console.log(\"[Rpc] WebSocket Message:\",data);\r\n\t\telse receiveRpc(new DataInput(new Uint8Array(data)))\r\n\t\t\t.catch(e=>console.warn(\"[Rpc] Error receiving Packet:\",e));\r\n\t};\r\n}\r\n\r\n(async function connectLoop(){\r\n\tawait Promise.resolve();//Moves from main into the event loop\r\n\r\n\t// noinspection InfiniteLoopJS\r\n\twhile(true)\r\n\t\tawait new Promise<void>(\r\n\t\t\tresolve=>connectOnce(resolve));\r\n}());\r\n","import {isConnected} from \"./WebSocketConnection.js\";\r\nimport {callRemoteFunction} from \"../types/functions/FunctionCallContext.js\";\r\n\r\n\r\nexport let RpcName:string|null=null;\r\n\r\nexport async function setName(name:string|null){\r\n\tRpcName=name;\r\n\ttry{\r\n\t\tif(isConnected) await callRemoteFunction(null,'N',name);\r\n\t}catch(e){\r\n\t\tconsole.error(`[Rpc] Error changing name to \"${name}\":`,e);\r\n\t}\r\n}","import {DataOutput} from \"./DataOutput.js\";\r\nimport {DataInput} from \"./DataInput.js\";\r\nimport {readRegistry,writeRegistry} from \"./DynamicData.js\";\r\n\r\n\r\ninterface CustomDynamicTypeInstance{\r\n\twrite(outgoing:DataOutput,already:unknown[]):void;\r\n}\r\n\r\ninterface CustomDynamicType<T extends CustomDynamicTypeInstance>{\r\n\tnew(...arg: any[]):T;\r\n\tread(incoming:DataInput,already:unknown[]):CustomDynamicTypeInstance;\r\n}\r\n\r\nexport function CustomDynamicType(id: string){\r\n\treturn function<T extends CustomDynamicTypeInstance>(target: CustomDynamicType<T>){\r\n\t\twriteRegistry.push([id,d=>d instanceof target,(data,o,already)=>(o as T).write(data,already)]);\r\n\t\treadRegistry.set(id,(data,already)=>target.read(data,already));\r\n\t};\r\n}","import {registerType} from \"../internal/RegisteredTypes.js\";\r\n\r\nexport function RpcProvider(type?: string){\r\n\treturn (target: any)=>void registerType(type??target.prototype.constructor.name,target);\r\n}\r\n","import {RpcName,setName} from \"./connection/RpcName.js\";\r\nimport {isConnected,waitConnected} from \"./connection/WebSocketConnection.js\";\r\nimport {\r\n\tcreateRemoteObject,\r\n\tRPC_ROOT,\r\n\tRpcObject,\r\n\tRpcObjectExists,\r\n\tRpcObjectGetMethods,\r\n\tRpcObjectType,\r\n} from \"./types/RpcObject.js\";\r\nimport {registerFunction,RpcFunction,unregisterFunction} from \"./types/RpcFunction.js\";\r\nimport {\r\n\tcallLocal,\r\n\tcallRemoteFunction,\r\n\tFunctionCallContext,\r\n\tgetFunctionContext,\r\n\trunWithContext,\r\n} from \"./types/functions/FunctionCallContext.js\";\r\nimport {generateTypeName,registerType,unregisterType} from \"./internal/RegisteredTypes.js\";\r\nimport {RpcId} from \"./connection/RpcId.js\";\r\nimport {PendingCall} from \"./types/functions/PendingCall.js\";\r\n\r\n\r\nexport * from \"./types/data/DataInput.js\";\r\nexport * from \"./types/data/DataOutput.js\";\r\nexport {CustomDynamicType} from \"./types/data/CustomDynamicTypeDecorator.js\";\r\n\r\nexport type {FunctionCallContext} from \"./types/functions/FunctionCallContext.js\";\r\nexport * from \"./types/functions/PendingCall.js\";\r\n\r\nexport * from \"./types/RpcObject.js\";\r\nexport * from \"./types/RpcFunction.js\";\r\nexport * from \"./types/RpcError.js\";\r\nexport {RpcCustomError} from \"./types/errors/RpcCustomErrorDecorator.js\";\r\nexport * from \"./types/errors/PredefinedErrors.js\";\r\nexport {RpcProvider} from \"./types/RpcProviderDecorator.js\";\r\n\r\nimport(\"./rpc.js\").then((m)=>Object.assign(globalThis,m));\r\n\r\n// noinspection JSUnusedGlobalSymbols\r\nexport class Rpc{\r\n\r\n\t//Rpc\r\n\tpublic static readonly id:string=RpcId;\r\n\r\n\tpublic static get prettyName():string{\r\n\t\treturn Rpc.name!=null?`${Rpc.name} (${Rpc.id})`:Rpc.id;\r\n\t}\r\n\r\n\tpublic static get name():string | null{\r\n\t\treturn RpcName;\r\n\t}\r\n\t\r\n\tpublic static setName=setName;\r\n\r\n\t//Connection\r\n\tpublic static get isConnected():boolean{\r\n\t\treturn isConnected;\r\n\t}\r\n\r\n\tpublic static get waitUntilConnected():Promise<void>{\r\n\t\treturn waitConnected();\r\n\t}\r\n\r\n\t//Functions\r\n\tpublic static createObject=createRemoteObject;\r\n\tpublic static createFunction=<T>(type:string,method:string)=>new RpcFunction<T>(type,method);\r\n\tpublic static registerFunction=registerFunction;\r\n\tpublic static unregisterFunction=unregisterFunction;\r\n\r\n\tpublic static callLocal=callLocal;//Call function and get a PendingCall, this allows the use of the FunctionCallContext within the function\r\n\tpublic static callFunction=callRemoteFunction;//Call remote function\r\n\r\n\tpublic static getContext:()=>FunctionCallContext=getFunctionContext;\r\n\tpublic static runWithContext=runWithContext;\r\n\r\n\t//Types\r\n\tpublic static registerType=registerType;\r\n\tpublic static unregisterType=unregisterType;\r\n\tpublic static generateTypeName=generateTypeName;\r\n\t\r\n\r\n\tpublic static getObjectWithFallback=async(type:string,...types:string[]):Promise<number>=>await callRemoteFunction(\"Rpc\",\"getObjectWithFallback\",type,...types);\r\n\tpublic static checkTypes=async(...types:string[]):Promise<number>=>await callRemoteFunction(\"Rpc\",\"checkTypes\",...types);\r\n\tpublic static checkType=async(type:string):Promise<boolean>=>await callRemoteFunction(\"Rpc\",\"checkType\",type);\r\n\tpublic static getAllTypes=async():Promise<string[]>=>await callRemoteFunction(\"Rpc\",\"getAllTypes\");\r\n\tpublic static getAllConnections=async():Promise<string[]>=>await callRemoteFunction(\"Rpc\",\"getAllConnections\");\r\n\tpublic static getRegistrations=async(includeHidden:boolean=false):Promise<(Record<string,string[]>)>=>await callRemoteFunction(\"Rpc\",\"getRegistrations\",includeHidden);\r\n\tpublic static evalObject=async(expression:string):Promise<any>=>await callRemoteFunction(\"Rpc\",\"evalObject\",expression);\r\n\tpublic static evalString=async(expression:string):Promise<string>=>await callRemoteFunction(\"Rpc\",\"evalString\",expression);\r\n\tpublic static listenCalls=():PendingCall=>callRemoteFunction(\"Rpc\",\"listenCalls\");\r\n\r\n\tpublic static root=RPC_ROOT;\r\n\t/** @deprecated*/\r\n\tpublic static type=RpcObjectType;\r\n\t/** @deprecated*/\r\n\tpublic static exists=RpcObjectExists;\r\n\t/** @deprecated*/\r\n\tpublic static getMethods=RpcObjectGetMethods;\r\n\t\r\n\tpublic static getObjectMethods=(o:RpcObject|string)=>(typeof o===\"string\"?createRemoteObject(o):o)[RpcObjectGetMethods]();\r\n\tpublic static getObjectExists=(o:RpcObject|string)=>(typeof o===\"string\"?createRemoteObject(o):o)[RpcObjectExists]();\r\n\tpublic static getObjectType=(o:RpcObject)=>o[RpcObjectType];\r\n}\r\n\r\n\r\n//import \"./_test/webTest.js\""],"names":["RpcCustomErrors","RpcCustomError","typeTag","target","tagToError","errorToTag","__name","root","factory","module","this","_isNumber","n","_capitalize","str","_getter","p","booleanProps","numericProps","stringProps","arrayProps","objectProps","props","StackFrame","obj","i","v","fileName","lineNumber","columnNumber","functionName","argsStartIndex","argsEndIndex","args","locationString","parts","j","k","require$$0","FIREFOX_SAFARI_STACK_REGEXP","CHROME_IE_STACK_REGEXP","SAFARI_NATIVE_CODE_REGEXP","error","urlLike","regExp","filtered","line","sanitizedLine","location","locationParts","functionNameRegex","matches","e","lineRE","lines","result","len","match","tokens","functionCall","argsRaw","fixString","s","framesToString","frames","frame","causeToString","cause","RpcError","ErrorStackParser","removeFromStackTrace","ownStack","#ownStack","#stackTrace","#causes","#appendStack","from","message","stackTrace","data","Rpc","causeIndex","trace","output","input","type","constructor","stackSource","skip","method","a","isNodeJs","chars","randomId","RpcId","quoted","RpcCallError","RpcTypeNotFoundError","__publicField","__decorateClass","RpcMethodNotFoundError","RpcMetaMethodNotFoundError","meta","RpcConnectionError","RpcEvalError","RpcDataError","registeredFunctions","registeredTypes","generateTypeName","registerType","invoker","isConnected","callRemoteFunction","unregisterType","getMethods","getter","RpcObjectGetMethods","key","invoke","func","ignoreCase","reference","PendingCall","dispose","resolve","reject","resolveCall","t","rejectCall","freeDynamic","onrejected","onfinally","onfulfilled","_args","registerReceive","getAsyncIterator","call","didReceive","waitReceive","request","res","pendingMap","listenersMap","pendings","pending","runReceiveMessage","currentContext","runWithContext","context","previous","getFunctionContext","nextId","local","callLocalFunction","already","buff","DataOutput","callId","PacketType","d","_webSocket","msgArgs","msg","list","sendRaw","sendCall","callLocal","controller","sending","received","invokeForPromise","RpcFunction","functionCache","registerFunction","id","unregisterFunction","RpcObjectType","RpcObjectExists","createRemoteObject","cache","_","argArray","RPC_ROOT","prop","writeRegistry","readRegistry","readDynamic","objectId","o","registryEntry","pattern","flags","objectType","writeDynamic","rpcFunc","onFree","buffer","element","check","write","idBytes","entries","value","size","additional","replacement","b","buf","c","array","u","arr","writeFunction","activeRequests","currentlyExecuting","disposeConnection","ctx","receiveRpc","packetType","finished","promise","rej","err","DataInput","pos","length","off","push","read","readFunction","resolveWaitUntilConnected","rejectWaitUntilConnected","waitUntilConnectedAttempt","waitConnected","createWebSocket","RPC_URL","RPC_TOKEN","query","uri","ws","closeRpc","connectOnce","reconnect","reportedName","RpcName","reportedTypes","webSocket","toRegister","toDelete","setName","name","CustomDynamicType","RpcProvider","rpc","m","types","includeHidden","expression"],"mappings":"+lBAEO,MAAMA,GAGX,CAAK,IAAA,QAAQ,GAAG,EACX,SAASC,EAAeC,EAAgB,CAC9C,OAAO,SAASC,EAAwB,CACjC,KAAA,CAACC,EAAWC,CAAU,EAAEL,GACnBI,EAAA,IAAIF,EAAQC,CAAM,EAClBE,EAAA,IAAIF,EAAOD,CAAO,CAAA,CAE/B,CANgBI,EAAAL,EAAA,8VCNf,SAASM,EAAMC,EAAS,CAQjBC,EAAA,QAAiBD,GAIxB,GAACE,GAAM,UAAW,CAEf,SAASC,EAAUC,EAAG,CAClB,MAAO,CAAC,MAAM,WAAWA,CAAC,CAAC,GAAK,SAASA,CAAC,CAC7C,CAFQN,EAAAK,EAAA,aAIT,SAASE,EAAYC,EAAK,CACtB,OAAOA,EAAI,OAAO,CAAC,EAAE,YAAW,EAAKA,EAAI,UAAU,CAAC,CACvD,CAFQR,EAAAO,EAAA,eAIT,SAASE,EAAQC,EAAG,CAChB,OAAO,UAAW,CACd,OAAO,KAAKA,CAAC,CACzB,CACK,CAJQV,EAAAS,EAAA,WAMT,IAAIE,EAAe,CAAC,gBAAiB,SAAU,WAAY,YAAY,EACnEC,EAAe,CAAC,eAAgB,YAAY,EAC5CC,EAAc,CAAC,WAAY,eAAgB,QAAQ,EACnDC,EAAa,CAAC,MAAM,EACpBC,EAAc,CAAC,YAAY,EAE3BC,EAAQL,EAAa,OAAOC,EAAcC,EAAaC,EAAYC,CAAW,EAElF,SAASE,EAAWC,EAAK,CACrB,GAAKA,EACL,QAASC,EAAI,EAAGA,EAAIH,EAAM,OAAQG,IAC1BD,EAAIF,EAAMG,CAAC,CAAC,IAAM,QAClB,KAAK,MAAQZ,EAAYS,EAAMG,CAAC,CAAC,CAAC,EAAED,EAAIF,EAAMG,CAAC,CAAC,CAAC,CAG5D,CAPQnB,EAAAiB,EAAA,cASTA,EAAW,UAAY,CACnB,QAAS,UAAW,CAChB,OAAO,KAAK,IACf,EACD,QAAS,SAASG,EAAG,CACjB,GAAI,OAAO,UAAU,SAAS,KAAKA,CAAC,IAAM,iBACtC,MAAM,IAAI,UAAU,uBAAuB,EAE/C,KAAK,KAAOA,CACf,EAED,cAAe,UAAW,CACtB,OAAO,KAAK,UACf,EACD,cAAe,SAASA,EAAG,CACvB,GAAIA,aAAaH,EACb,KAAK,WAAaG,UACXA,aAAa,OACpB,KAAK,WAAa,IAAIH,EAAWG,CAAC,MAElC,OAAM,IAAI,UAAU,6CAA6C,CAExE,EAED,SAAU,UAAW,CACjB,IAAIC,EAAW,KAAK,YAAW,GAAM,GACjCC,EAAa,KAAK,cAAa,GAAM,GACrCC,EAAe,KAAK,gBAAe,GAAM,GACzCC,EAAe,KAAK,gBAAe,GAAM,GAC7C,OAAI,KAAK,YACDH,EACO,WAAaA,EAAW,IAAMC,EAAa,IAAMC,EAAe,IAEpE,UAAYD,EAAa,IAAMC,EAEtCC,EACOA,EAAe,KAAOH,EAAW,IAAMC,EAAa,IAAMC,EAAe,IAE7EF,EAAW,IAAMC,EAAa,IAAMC,CAC9C,CACT,EAEIN,EAAW,WAAajB,EAAA,SAAgCQ,EAAK,CACzD,IAAIiB,EAAiBjB,EAAI,QAAQ,GAAG,EAChCkB,EAAelB,EAAI,YAAY,GAAG,EAElCgB,GAAehB,EAAI,UAAU,EAAGiB,CAAc,EAC9CE,GAAOnB,EAAI,UAAUiB,EAAiB,EAAGC,CAAY,EAAE,MAAM,GAAG,EAChEE,GAAiBpB,EAAI,UAAUkB,EAAe,CAAC,EAEnD,GAAIE,GAAe,QAAQ,GAAG,IAAM,EAChC,IAAIC,GAAQ,gCAAgC,KAAKD,GAAgB,EAAE,EAC/DP,GAAWQ,GAAM,CAAC,EAClBP,GAAaO,GAAM,CAAC,EACpBN,GAAeM,GAAM,CAAC,EAG9B,OAAO,IAAIZ,EAAW,CAClB,aAAcO,GACd,KAAMG,IAAQ,OACd,SAAUN,GACV,WAAYC,IAAc,OAC1B,aAAcC,IAAgB,MAC1C,CAAS,CACT,EAtB4B,0BAwBxB,QAASJ,EAAI,EAAGA,EAAIR,EAAa,OAAQQ,IACrCF,EAAW,UAAU,MAAQV,EAAYI,EAAaQ,CAAC,CAAC,CAAC,EAAIV,EAAQE,EAAaQ,CAAC,CAAC,EACpFF,EAAW,UAAU,MAAQV,EAAYI,EAAaQ,CAAC,CAAC,CAAC,EAAK,SAAST,EAAG,CACtE,OAAO,SAASU,EAAG,CACf,KAAKV,CAAC,EAAI,EAAQU,CAClC,CACA,EAAWT,EAAaQ,CAAC,CAAC,EAGtB,QAASW,EAAI,EAAGA,EAAIlB,EAAa,OAAQkB,IACrCb,EAAW,UAAU,MAAQV,EAAYK,EAAakB,CAAC,CAAC,CAAC,EAAIrB,EAAQG,EAAakB,CAAC,CAAC,EACpFb,EAAW,UAAU,MAAQV,EAAYK,EAAakB,CAAC,CAAC,CAAC,EAAK,SAASpB,EAAG,CACtE,OAAO,SAASU,EAAG,CACf,GAAI,CAACf,EAAUe,CAAC,EACZ,MAAM,IAAI,UAAUV,EAAI,mBAAmB,EAE/C,KAAKA,CAAC,EAAI,OAAOU,CAAC,CAClC,CACA,EAAWR,EAAakB,CAAC,CAAC,EAGtB,QAASC,EAAI,EAAGA,EAAIlB,EAAY,OAAQkB,IACpCd,EAAW,UAAU,MAAQV,EAAYM,EAAYkB,CAAC,CAAC,CAAC,EAAItB,EAAQI,EAAYkB,CAAC,CAAC,EAClFd,EAAW,UAAU,MAAQV,EAAYM,EAAYkB,CAAC,CAAC,CAAC,EAAK,SAASrB,EAAG,CACrE,OAAO,SAASU,EAAG,CACf,KAAKV,CAAC,EAAI,OAAOU,CAAC,CAClC,CACA,EAAWP,EAAYkB,CAAC,CAAC,EAGrB,OAAOd,CACX,CAAC,6DC9IA,SAAShB,EAAMC,EAAS,CAQjBC,EAAiB,QAAAD,EAAQ8B,GAAqB,CAAA,CAItD,GAAE5B,GAAMJ,EAAA,SAA0BiB,EAAY,CAG1C,IAAIgB,EAA8B,eAC9BC,EAAyB,iCACzBC,EAA4B,8BAEhC,MAAO,CAOH,MAAOnC,EAAA,SAAiCoC,EAAO,CAC3C,GAAI,OAAOA,EAAM,WAAe,KAAe,OAAOA,EAAM,iBAAiB,EAAM,IAC/E,OAAO,KAAK,WAAWA,CAAK,EACzB,GAAIA,EAAM,OAASA,EAAM,MAAM,MAAMF,CAAsB,EAC9D,OAAO,KAAK,YAAYE,CAAK,EAC1B,GAAIA,EAAM,MACb,OAAO,KAAK,gBAAgBA,CAAK,EAEjC,MAAM,IAAI,MAAM,iCAAiC,CAExD,EAVM,2BAaP,gBAAiBpC,EAAA,SAA2CqC,EAAS,CAEjE,GAAIA,EAAQ,QAAQ,GAAG,IAAM,GACzB,MAAO,CAACA,CAAO,EAGnB,IAAIC,EAAS,+BACTT,EAAQS,EAAO,KAAKD,EAAQ,QAAQ,QAAS,EAAE,CAAC,EACpD,MAAO,CAACR,EAAM,CAAC,EAAGA,EAAM,CAAC,GAAK,OAAWA,EAAM,CAAC,GAAK,MAAS,CACjE,EATgB,qCAWjB,YAAa7B,EAAA,SAAuCoC,EAAO,CACvD,IAAIG,EAAWH,EAAM,MAAM,MAAM;AAAA,CAAI,EAAE,OAAO,SAASI,EAAM,CACzD,MAAO,CAAC,CAACA,EAAK,MAAMN,CAAsB,CAC7C,EAAE,IAAI,EAEP,OAAOK,EAAS,IAAI,SAASC,EAAM,CAC3BA,EAAK,QAAQ,QAAQ,EAAI,KAEzBA,EAAOA,EAAK,QAAQ,aAAc,MAAM,EAAE,QAAQ,6BAA8B,EAAE,GAEtF,IAAIC,EAAgBD,EAAK,QAAQ,OAAQ,EAAE,EAAE,QAAQ,eAAgB,GAAG,EAAE,QAAQ,UAAW,EAAE,EAI3FE,EAAWD,EAAc,MAAM,YAAY,EAG/CA,EAAgBC,EAAWD,EAAc,QAAQC,EAAS,CAAC,EAAG,EAAE,EAAID,EAIpE,IAAIE,EAAgB,KAAK,gBAAgBD,EAAWA,EAAS,CAAC,EAAID,CAAa,EAC3EjB,EAAekB,GAAYD,GAAiB,OAC5CpB,EAAW,CAAC,OAAQ,aAAa,EAAE,QAAQsB,EAAc,CAAC,CAAC,EAAI,GAAK,OAAYA,EAAc,CAAC,EAEnG,OAAO,IAAI1B,EAAW,CAClB,aAAcO,EACd,SAAUH,EACV,WAAYsB,EAAc,CAAC,EAC3B,aAAcA,EAAc,CAAC,EAC7B,OAAQH,CAC5B,CAAiB,CACJ,EAAE,IAAI,CACV,EAjCY,iCAmCb,gBAAiBxC,EAAA,SAA2CoC,EAAO,CAC/D,IAAIG,EAAWH,EAAM,MAAM,MAAM;AAAA,CAAI,EAAE,OAAO,SAASI,EAAM,CACzD,MAAO,CAACA,EAAK,MAAML,CAAyB,CAC/C,EAAE,IAAI,EAEP,OAAOI,EAAS,IAAI,SAASC,EAAM,CAM/B,GAJIA,EAAK,QAAQ,SAAS,EAAI,KAC1BA,EAAOA,EAAK,QAAQ,mDAAoD,KAAK,GAG7EA,EAAK,QAAQ,GAAG,IAAM,IAAMA,EAAK,QAAQ,GAAG,IAAM,GAElD,OAAO,IAAIvB,EAAW,CAClB,aAAcuB,CACtC,CAAqB,EAED,IAAII,EAAoB,6BACpBC,EAAUL,EAAK,MAAMI,CAAiB,EACtCpB,EAAeqB,GAAWA,EAAQ,CAAC,EAAIA,EAAQ,CAAC,EAAI,OACpDF,EAAgB,KAAK,gBAAgBH,EAAK,QAAQI,EAAmB,EAAE,CAAC,EAE5E,OAAO,IAAI3B,EAAW,CAClB,aAAcO,EACd,SAAUmB,EAAc,CAAC,EACzB,WAAYA,EAAc,CAAC,EAC3B,aAAcA,EAAc,CAAC,EAC7B,OAAQH,CAChC,CAAqB,CAER,EAAE,IAAI,CACV,EA/BgB,qCAiCjB,WAAYxC,EAAA,SAAsC8C,EAAG,CACjD,MAAI,CAACA,EAAE,YAAeA,EAAE,QAAQ,QAAQ;AAAA,CAAI,EAAI,IAC5CA,EAAE,QAAQ,MAAM;AAAA,CAAI,EAAE,OAASA,EAAE,WAAW,MAAM;AAAA,CAAI,EAAE,OACjD,KAAK,YAAYA,CAAC,EACjBA,EAAE,MAGH,KAAK,aAAaA,CAAC,EAFnB,KAAK,aAAaA,CAAC,CAIjC,EATW,gCAWZ,YAAa9C,EAAA,SAAuC8C,EAAG,CAKnD,QAJIC,EAAS,oCACTC,EAAQF,EAAE,QAAQ,MAAM;AAAA,CAAI,EAC5BG,EAAS,CAAA,EAEJ9B,EAAI,EAAG+B,EAAMF,EAAM,OAAQ7B,EAAI+B,EAAK/B,GAAK,EAAG,CACjD,IAAIgC,EAAQJ,EAAO,KAAKC,EAAM7B,CAAC,CAAC,EAC5BgC,GACAF,EAAO,KAAK,IAAIhC,EAAW,CACvB,SAAUkC,EAAM,CAAC,EACjB,WAAYA,EAAM,CAAC,EACnB,OAAQH,EAAM7B,CAAC,CAClB,CAAA,CAAC,CAET,CAED,OAAO8B,CACV,EAjBY,iCAmBb,aAAcjD,EAAA,SAAwC8C,EAAG,CAKrD,QAJIC,EAAS,6DACTC,EAAQF,EAAE,WAAW,MAAM;AAAA,CAAI,EAC/BG,EAAS,CAAA,EAEJ9B,EAAI,EAAG+B,EAAMF,EAAM,OAAQ7B,EAAI+B,EAAK/B,GAAK,EAAG,CACjD,IAAIgC,EAAQJ,EAAO,KAAKC,EAAM7B,CAAC,CAAC,EAC5BgC,GACAF,EAAO,KACH,IAAIhC,EAAW,CACX,aAAckC,EAAM,CAAC,GAAK,OAC1B,SAAUA,EAAM,CAAC,EACjB,WAAYA,EAAM,CAAC,EACnB,OAAQH,EAAM7B,CAAC,CAC3C,CAAyB,CACzB,CAEa,CAED,OAAO8B,CACV,EApBa,kCAuBd,aAAcjD,EAAA,SAAwCoC,EAAO,CACzD,IAAIG,EAAWH,EAAM,MAAM,MAAM;AAAA,CAAI,EAAE,OAAO,SAASI,EAAM,CACzD,MAAO,CAAC,CAACA,EAAK,MAAMP,CAA2B,GAAK,CAACO,EAAK,MAAM,mBAAmB,CACtF,EAAE,IAAI,EAEP,OAAOD,EAAS,IAAI,SAASC,EAAM,CAC/B,IAAIY,EAASZ,EAAK,MAAM,GAAG,EACvBG,EAAgB,KAAK,gBAAgBS,EAAO,IAAK,CAAA,EACjDC,EAAgBD,EAAO,MAAO,GAAI,GAClC5B,EAAe6B,EACd,QAAQ,iCAAkC,IAAI,EAC9C,QAAQ,aAAc,EAAE,GAAK,OAC9BC,EACAD,EAAa,MAAM,aAAa,IAChCC,EAAUD,EAAa,QAAQ,qBAAsB,IAAI,GAE7D,IAAI1B,EAAQ2B,IAAY,QAAaA,IAAY,4BAC7C,OAAYA,EAAQ,MAAM,GAAG,EAEjC,OAAO,IAAIrC,EAAW,CAClB,aAAcO,EACd,KAAMG,EACN,SAAUgB,EAAc,CAAC,EACzB,WAAYA,EAAc,CAAC,EAC3B,aAAcA,EAAc,CAAC,EAC7B,OAAQH,CAC5B,CAAiB,CACJ,EAAE,IAAI,CACV,EA5Ba,iCA6BtB,CACA,EA7LQ,mBA6LP,yCCrMD,SAASe,GAAUC,EAAS,CACpB,OAAAA,EAAE,WAAW,KAAK,EAAE,EACzB,WAAW,aAAa,EAAE,EAC1B,WAAW,SAAS,GAAI,CAC3B,CAJSxD,EAAAuD,GAAA,aAMT,SAASE,EAAeC,EAA2B,CAClD,IAAIT,EAAO,GACX,QAAQU,KAASD,EACb,IAAAC,EAAM,cAAc,SAAS,oBAAoB,EAAG,MAClDV,GAAQ;AAAA,MAAUU,EACjB,OAAAV,CACR,CANSjD,EAAAyD,EAAA,kBAQT,SAASG,GAAcC,EAAqB,CAC3C,OAAGA,IAAQ,OAAkB,GAC1BA,aAAiBC,EAAiB;AAAA,aAAgBD,EAAM,WACxDA,aAAiB,MACZ;AAAA,aAAgBN,GAAUM,EAAM,SAAA,CAAU,EAC/CJ,EAAeM,EAAiB,MAAMF,CAAK,CAAC,EAC5CD,GAAcC,EAAM,KAAK,EACrB;AAAA,aAAgBN,GAAUM,GAAO,YAAY,MAAM,CAC3D,CARS7D,EAAA4D,GAAA,iBAYT,SAASI,GAAqBlB,EAAoCmB,EAA8B,CAC/F,OAAInB,IAAIgB,GAAUE,GAAqBlB,EAAE,UAAUmB,CAAQ,IACxDA,EAAS,CAAC,EAAE,cAAc,QAAQ,QAAQ,EAAE,IAAInB,EAAE,MACpDmB,EAAS,MAAM,EACR,IACK,EACd,CANSjE,EAAAgE,GAAA,wBAQF,MAAMF,UAAiB,KAAK,OAAA,CAAA9D,EAAA,iBAGlB,KACA,KAAwB,CAAA,EACxCkE,GAAuB,CAAA,EAEvB,IAAW,YAAY,CACtB,IAAIjB,EAAO,KAAKkB,GACR,OAAAlB,GAAAQ,EAAe,KAAKS,EAAS,EACrCjB,GAAQ,KAAKmB,GACNnB,EAAO,WAAW,QAAQ,EAAE,CACpC,CAEAkB,GAAmB,GACnBE,GAAa,GACJD,GAAe,GAQxB,eAAezC,EAOd,CAEA,IAAI2C,EAAmB,KACnBC,EAAsB,KACtBC,EAAyB,KACzBC,EAAwB,CAAA,EACxBZ,EAEJ,OAAOlC,EAAK,OAAO,CAClB,IAAK,GACJ,CAAC4C,CAAO,EAAE5C,EACV,MACD,IAAK,GACH,CAAA4C,EAAQV,CAAK,EAAElC,EAChB,MACD,IAAK,GACJ,CAAC4C,EAAQD,EAAKC,EAAQC,CAAU,EAAE7C,EAClC,MACD,IAAK,GACDA,EAAK,CAAC,YAAamC,EAAU,CAACS,EAAQD,EAAKC,EAAQC,EAAWX,CAAK,EAAElC,EACnE,CAAC4C,EAAQD,EAAKC,EAAQC,EAAWC,CAAI,EAAE9C,EAC5C,MACD,IAAK,GACJ,CAAC4C,EAAQD,EAAKC,EAAQC,EAAWC,EAAKZ,CAAK,EAAElC,EAC7C,MACD,QACO,MAAA,IAAI,MAAM,mBAAmB,CACrC,CAEGkC,GAAO,KAAM,MAAMU,GAAS,OAAU,CAAC,MAAAV,CAAM,CAAA,EAC3C,MAAMU,GAAS,MAAS,EAExB,KAAA,KAAW,KAAK,YAAY,KAC5B,KAAA,KAAKD,GAAMI,EAAI,WAEpB,MAAM9E,EAAQF,GAAgB,CAAC,EAAE,IAAI,KAAK,WAAkB,EAK5D,GAJGE,GAAS,OAAW,KAAA,KAAK,MAASA,GACrC,OAAO,OAAO,KAAK,KAAK6E,GAAM,CAAE,CAAA,EAG7BD,GAAY,KACd,KAAKH,GAAa,GACb,KAAAH,GAAUH,EAAiB,MAAM,IAAI,EACrBC,GAAA,KAAK,YAAmB,KAAKE,EAAS,MACvD,CACC,KAAAC,GAAY;AAAA,EAAKZ,GAAUiB,CAAU,EAC1C,MAAMG,EAAW,KAAKR,GAAY,QAAQ;AAAA,YAAe,EACtDQ,GAAa,KACf,KAAKP,IAAS,KAAKD,GAAY,UAAUQ,CAAU,EACnD,KAAKR,GAAY,KAAKA,GAAY,UAAU,EAAEQ,CAAU,EAE1D,CAEK,KAAAP,IAASR,GAAcC,CAAK,EAE5B,KAAA,MAAM,KAAK,UACjB,CAEA,UAAU,CACT,IAAIL,EAAE,KAAK,KAAK,IAAI,KAAK,KAAK,IAC3B,KAAK,SAAS,KAAK,IAAGA,GAAG,KAAK,KAAK,SAEtC,MAAMoB,EAAM,KAAK,WACjB,OAAGA,GAAO,KAAK,IAAGpB,GAAG;AAAA,EAAKoB,GAEnBpB,CACR,CAEA,MAAMqB,EAAkB,CAChBA,EAAA,YAAY,KAAK,IAAI,EACrBA,EAAA,YAAY,KAAK,IAAI,EACrBA,EAAA,YAAY,KAAK,OAAO,EACxBA,EAAA,YAAY,KAAK,UAAU,EAClCA,EAAO,YAAY,OAAO,KAAK,KAAK,IAAI,EAAE,QAAQ,EAAE,KAAK,KAAK,UAAU,KAAK,IAAI,CAAC,CACnF,CAEA,OAAO,KAAKC,EAAgB,CACrB,MAAAC,EAAKD,EAAM,aACXR,EAAKQ,EAAM,WAAA,GAAc,MACzBP,EAAQO,EAAM,aACdN,EAAWM,EAAM,WAAA,GAAc,GAEjC,IAAAL,EACD,GAAA,CACFA,EAAK,KAAK,MAAMK,EAAM,WAAA,GAAc,MAAM,QACpChC,EAAE,CACR,GAAGA,aAAa,WACV2B,EAAA,CAAC,MAAQ,mEACJ,OAAA3B,CACZ,CAEA,OAAOgB,EAAS,OAAOiB,EAAKT,EAAKC,EAAQC,EAAWC,CAAI,CACzD,CAEA,OAAO,OAAOM,EAAmBT,EAAYC,EAAsBC,EAAkBC,EAAwB,CACtG,MAAA7E,EAAQ6E,GAAO,MACfO,EAA4BtF,GAAgB,CAAC,EAAE,IAAIE,CAAO,GAAGkE,EACnE,OAAO,IAAIkB,EAAYD,EAAKT,EAAKC,EAAQC,EAAWC,CAAI,CACzD,CAGA,OAAO,cAAc,EAAiB,CACrC,OAAG,aAAaX,GACX,EAAEO,KACN,EAAEA,GAAa,GACb,EAAAF,IAAaV,EAAe,EAAES,EAAS,EACzC,EAAEA,GAAU,GACV,EAAA,MAAM,EAAE,YACH,GAGD,IAAIJ,EACV,EAAE,KACF,aAAaA,EAAS,EAAE,KAAK,KAC7B,EAAE,QACFL,EAAeM,EAAiB,MAAM,CAAC,CAAC,EAAE,UAAU,CAAC,EACrD,CAAC,EACD,EAAE,KAAA,CAEJ,CAEA,SAASkB,EAAkBC,EAAY,CACtC,OAAG,KAAKb,GAAqB,MAC7B,KAAKA,GAAa,GAClB,KAAKH,GAAUH,EAAiB,MAAMkB,CAAW,EAAE,MAAMC,CAAI,EACxD,KAAA,MAAM,KAAK,WACT,KACR,CAEA,iBAAiB,CAChB,YAAKb,GAAa,GAClB,KAAKH,GAAU,GACV,KAAA,MAAM,KAAK,WACT,IACR,CAEA,OAAOa,EAAmBI,EAAqBxD,EAAkB,CAC3D,YAAAwC,IAAa;AAAA,QAAYxC,GAAM,KAClC,iBACCoD,GAAM,YAAY,KAAKI,GAAQ,YAAY,IAC7CxD,EAAK,OAAO,KAAK,UAAUyD,CAAC,CAAC,EAAE,KAAK,GAAG,EAAE,KACrC,KAAA,MAAM,KAAK,WACT,IACR,CACD,CCrNO,MAAMC,GAAS,YAAY,SAAS,UAAU,MAAM,KAErDC,GAAM,iEACCC,GAASvF,EAAA,IAAI,KAAK,IAAA,EAAM,SAAS,EAAE,EAAE,MAAM,EAAE,EACxD,KAAK,MAAS,EACd,IAAI,IAAIsF,GAAM,KAAK,MAAM,KAAK,OAAO,EAAEA,GAAM,MAAM,CAAC,CAAC,EACrD,KAAK,EAAE,EAHa,YAOX,IAAAE,EACX,GAAGH,GACC,GAAA,CACC,SAAS,SAAS,IACpBG,EAAM,OAAO,QAAQ,IAAI,EAAE,WAAW,IAAI,QAAQ,IAI5CA,EAAA,QAAQ,QAAQ,QAAQ,IAAI,EAAE,cAAc,IAAI,QAAQ,GAAA,MAC1D,CACLA,EAAM,oBAAoB,QAAQ,SAAS,IAAI,QAAQ,KAAK,IAAI,QAAQ,GACzE,KACO,aAAc,WAAYA,EAAM,OAAO,SAAS,SAAS,IAAID,GAAS,EAE7EC,EAAM,MAAMD,GAAS,0YCrBtB,MAAME,EAAOzF,EAACwD,GAAkBA,GAAG,KAAK,OAAO,IAAKA,EAAE,IAAzC,UAEN,MAAekC,UAAqB5B,CAAQ,OAAA,CAAA9D,EAAA,qBAAC,CAGvC2F,QAAAA,qBAAN,cAAmCD,CAAY,OAAA,CAAA1F,EAAA,6BAGtD,EAFC4F,EADYD,6BACL,MAAKZ,GAAqB,IAAIY,QAAA,qBAAqB,KAAK,KAC9D,QAAQF,EAAOV,CAAI,CAAC,kBAAkB,GAAG,CAAC,KAAAA,CAAI,CAAC,CAAA,EAFpCY,QAAN,qBAAAE,EAAA,CADNlG,EAAe,OAAO,CAAA,EACVgG,QAAA,oBAAA,EAMAG,QAAAA,uBAAN,cAAqCJ,CAAY,OAAA,CAAA1F,EAAA,+BAGxD,EAFC4F,EADYE,QACL,uBAAA,MAAI,CAACf,EAAmBI,IAAuB,IAAIW,QAAA,uBAAuB,KAAK,KACrF,UAAUL,EAAON,CAAM,CAAC,2BAA2BM,EAAOV,CAAI,CAAC,GAAG,GAAG,CAAC,KAAAA,EAAK,OAAAI,CAAM,CAAC,CAAA,EAFvEW,QAAN,uBAAAD,EAAA,CADNlG,EAAe,SAAS,CAAA,EACZmG,QAAA,sBAAA,EAMAC,QAAAA,2BAAN,cAAyCD,QAAAA,sBAAsB,OAAA,CAAA9F,EAAA,mCAGtE,EAFC4F,EADYG,QACL,2BAAA,MAAI,CAAChB,EAAmBiB,IAAqB,IAAID,QAAA,2BAA2B,KAAK,KACvF,eAAeN,EAAOO,CAAI,CAAC,2BAA2BP,EAAOV,CAAI,CAAC,GAAG,GAAG,CAAC,KAAAA,EAAK,OAAO,KAAK,KAAAiB,CAAI,CAAC,CAAA,EAFpFD,QAAN,2BAAAF,EAAA,CADNlG,EAAe,cAAc,CAAA,EACjBoG,QAAA,0BAAA,EAMAE,QAAAA,mBAAN,cAAiCP,CAAY,OAAA,CAAA1F,EAAA,2BAEpD,EADC4F,EADYK,2BACL,MAAK1B,GAAwB,IAAI0B,QAAAA,mBAAmB,KAAK,KAAK1B,EAAQ,EAAE,CAAA,EADnE0B,QAAN,mBAAAJ,EAAA,CADNlG,EAAe,aAAa,CAAA,EAChBsG,QAAA,kBAAA,EAKAC,QAAAA,aAAN,cAA2BR,CAAY,OAAA,CAAA1F,EAAA,qBAAC,EAAlCkG,QAAN,aAAAL,EAAA,CADNlG,EAAe,OAAO,CAAA,EACVuG,QAAA,YAAA,EAGAC,QAAAA,aAAN,cAA2BrC,CAAQ,OAAA,CAAA9D,EAAA,qBAE1C,EADC4F,EADYO,QAAA,aACL,MAAI,CAAC5B,EAAeV,IAAc,IAAIsC,QAAAA,aAAa,KAAK,KAAK5B,EAAQ,GAAGV,CAAK,CAAA,EADxEsC,QAAN,aAAAN,EAAA,CADNlG,EAAe,OAAO,CAAA,EACVwG,oBAAA,ECrBA,MAAAC,GAAmC,OAAA,OAAO,IAAI,EAC9CC,MAAoB,IACjCA,EAAgB,IAAI,IAAIb,EAAMY,EAAmB,EAGjD,eAAsBE,IAAkB,CAChC,MAAA,IAAId,EAAM,IAAID,GAAS,CAC/B,CAFsBvF,EAAAsG,GAAA,oBAIA,eAAAC,GAAaxB,EAAYyB,EAA8B,CACzE,GAAA,CAAAH,EAAgB,IAAItB,CAAI,EACX,CAAAsB,EAAA,IAAItB,EAAKyB,CAAO,EAE7B,GAAA,CACCC,GACI,MAAAC,EAAmB,KAAK,IAAI3B,CAAI,QACjCjC,EAAE,CACR,QAAQ,MAAM,iCAAiCiC,CAAI,KAAKjC,CAAC,EAEzDuD,EAAgB,OAAOtB,CAAI,CAC5B,EACD,CAZsB/E,EAAAuG,GAAA,gBActB,eAAsBI,GAAe5B,EAA0B,CAC3D,GAACsB,EAAgB,IAAItB,CAAI,EAEzB,IAAA,CACC0B,GACI,MAAAC,EAAmB,KAAK,IAAI3B,CAAI,QACjC,EAAE,CACR,QAAQ,MAAM,mCAAmCA,CAAI,KAAK,CAAC,CAG5D,CACAsB,EAAgB,OAAOtB,CAAI,EAC5B,CAZsB/E,EAAA2G,GAAA,kBAetB,eAAeC,GAAWJ,EAAkC,CACrD,MAAAK,EAAOL,EAAQM,CAAmB,EACrC,OAAAD,EAAe,MAAMA,EAAO,KAAKL,CAAO,EAEpC,OAAO,oBAAoBA,CAAO,EAAE,UAAY,OAAOA,EAAQO,CAAG,GAAG,UAAU,CACvF,CALe/G,EAAA4G,GAAA,cAOf,eAAsBI,GAAOR,EAAgBzB,EAAYI,KAAwBxD,EAAwB,CACxG,GAAGwD,GAAQ,KAAK,CACX,IAAA8B,EAAKT,EAAQrB,CAAM,EACvB,GAAG8B,GAAM,KAAK,CACb,IAAIC,GAAY,MAAMN,GAAWJ,CAAO,GAAG,KAAQhD,GAAAA,EAAE,YAAY,GAAG2B,EAAO,YAAa,CAAA,EACrF+B,GAAY,OAAMD,EAAKT,EAAQU,CAAU,EAC7C,CAEM,MAAAC,EAAW,GAAIhC,CAAM,EAExB,GAAA8B,GAAM,MAAMA,IAAOE,EAAgB,MAAArB,+BAAuB,IAAIf,EAAKI,CAAM,EACzE,GAAA,CACF,OAAO,KAAQ,CACd,MAAM,oBAAoB,CACzB,OAAO,MAAM8B,EAAK,KAAKT,EAAQ,GAAG7E,CAAI,CACvC,CAAA,EACE,mBAAuB,QAEpBmB,EAAE,CACF,MAAAgB,EAAS,cAAchB,CAAU,CACxC,CACD,CAEA,MAAMkD,EAAKrE,EAAK,QAAQ,EAAE,KAAKA,EAAK,CAAC,EACrC,OAAOqE,EAAK,CACX,IAAK,IACJ,OAAOY,GAAWJ,CAAO,EAC1B,QACO,MAAAT,mCAA2B,IAAIhB,EAAKiB,CAAI,CAChD,CACD,CA9BsBhG,EAAAgH,GAAA,UClDf,MAAMI,EAA4C,OAAA,CAAApH,EAAA,oBACxD,CAAiB,OAAO,WAAW,EAAS,cACrC,SAAS,GACA,QAEhB,YAAYkF,EAAYmC,EAAkB,CACtC,GAAA,CAEF,MAAM,IAAI,YACJpC,EAAY,CAClB,KAAK,QAAQ,IAAI,QAAQ,CAACqC,EAAQC,IAAS,CAC9BC,EAAA,IAAI,KAAQC,GAAA,CACvBD,EAAY,OAAO,IAAI,EACvBE,EAAW,OAAO,IAAI,EACtB,KAAK,SAAS,GACdJ,EAAQG,CAAC,EACTE,GAAYN,CAAO,CAAA,CACnB,EACUK,EAAA,IAAI,KAAQ5E,GAAA,CACtB0E,EAAY,OAAO,IAAI,EACvBE,EAAW,OAAO,IAAI,EACtB,KAAK,SAAS,GACdH,EAAOzE,aAAagB,EAAShB,EAAE,SAASmC,EAAmBC,CAAI,EAAEpC,CAAC,EAClE6E,GAAYN,CAAO,CAAA,CACnB,CAAA,CACD,CACF,CACD,CAEA,MAAqBO,EAAqG,CAClH,OAAA,KAAK,QAAQ,MAAMA,CAAU,CACrC,CAEA,QAAQC,EAAoD,CACpD,OAAA,KAAK,QAAQ,QAAQA,CAAS,CACtC,CAEA,KAAgCC,EAAgFF,EAA+G,CAC9N,OAAO,KAAK,QAAQ,KAAKE,EAAYF,CAAU,CAChD,CAEA,eAAeG,EAA2B,CAClC,OAAA,IACR,CAEA,mBAA6Cd,EAAyC,CAC9E,OAAAe,EAAgB,KAAKf,CAA6B,CAC1D,CAEA,QAAQ,CAAC,CAET,WAA2B,CACnB,OAAA,QAAQ,QAAQvC,EAAI,UAAU,CACtC,CAEA,CAAC,OAAO,aAAa,GAAwB,CAC5C,OAAOuD,EAAiB,IAAI,CAC7B,CACD,CAEO,SAASA,EAAiBC,EAAgE,CAChG,IAAIC,EAAuC,CAAA,EACvCC,EAAoD,CAAA,EAEnD,OAAAF,EAAA,QAAQ,MAAM,IAAI,CAAA,CAAE,EACpBA,EAAA,QAAQ,QAAQ,IAAI,CACxB,QAAQG,KAAWD,EAAaC,EAAQ,CAAC,KAAK,GAAK,MAAM,OAAU,CAAA,CACnE,EACIH,EAAA,mBAAmB,IAAIvG,IAAO,EACjCyG,EAAY,SAASD,EAAW,MAAM,CAAC,KAAK,GAAM,MAAMxG,CAAA,CAAK,CAAA,CAC9D,EAEM,CACN,MAAM,MAAyC,CAC9C,OAAGuG,EAAK,SAAiB,CAAC,KAAK,GAAK,MAAM,MAAS,EAC5CC,EAAW,SAAU,MAAM,IAAI,QAAaG,GAAAF,EAAY,KAAKE,CAAG,CAAC,CACzE,CAAA,CAEF,CAlBgBtI,EAAAiI,EAAA,oBAoBH,MAAAT,MAAgB,QAChBE,MAAe,QACfa,MAAe,QACfC,MAAiB,QAEd,SAAAR,EAAmEE,EAAajB,EAA2B,CACvH,GAAAuB,EAAa,IAAIN,CAAI,EACvBM,EAAa,IAAIN,CAAI,EAAG,KAAKjB,CAAI,MAC7B,CACJuB,EAAa,IAAIN,EAAK,CAACjB,CAAI,CAAC,EAC5B,MAAMwB,EAASF,EAAW,IAAIL,CAAI,GAAG,CAAA,EACrC,QAAQQ,KAAWD,EACf,GAAA,CACFxB,EAAK,GAAGyB,CAAO,QACT5F,EAAE,CACA,QAAA,KAAK,8CAA8CA,CAAC,CAC7D,CAEF,CACO,OAAAoF,CACR,CAfgBlI,EAAAgI,EAAA,mBAiBA,SAAAW,EAAkBT,EAAuCvG,EAAW,CACnF,GAAG,CAAAuG,EAAK,SAEL,GAAAM,EAAa,IAAIN,CAAI,EACvB,QAAQjB,KAAQuB,EAAa,IAAIN,CAAI,EACjC,GAAA,CACFjB,EAAK,GAAGtF,CAAI,QACNmB,EAAE,CACA,QAAA,KAAK,uCAAuCA,CAAC,CACtD,MAEOyF,EAAW,IAAIL,CAAI,EAChBK,EAAA,IAAIL,EAAK,CAAC,GAAGK,EAAW,IAAIL,CAAI,EAAGvG,CAAI,CAAC,EAEnD4G,EAAW,IAAIL,EAAK,CAACvG,CAAI,CAAC,CAE5B,CAhBgB3B,EAAA2I,EAAA,qBCrGhB,IAAIC,EAA0C,KAE9B,SAAAC,GAAkB5B,EAAW6B,EAA8B,CAC1E,MAAMC,EAAoCH,EAC3BA,EAAAE,EACZ,GAAA,CACF,OAAO7B,EAAK,CAAA,QACZ,CACe2B,EAAAG,CAChB,CACD,CARgB/I,EAAA6I,GAAA,kBAUT,SAASG,IAAwC,CACvD,GAAGJ,GAAgB,KAAY,MAAA,IAAI,MAAM,mCAAmC,EACrE,OAAAA,CACR,CAHgB5I,EAAAgJ,GAAA,sBAMhB,IAAIC,GAAO,EAEK,SAAAvC,EAA8B3B,EAAmBI,KAAwBxD,EAA0B,CAClH,GAAGoD,GAAM,KAAK,CACP,MAAAmE,EAAM7C,EAAgB,IAAItB,CAAI,EACjC,GAAAmE,EAAO,OAAOC,GAAqBnC,GAAO,KAAK,KAAKkC,EAAMnE,EAAKI,EAAO,GAAGxD,CAAI,EAAEoD,EAAKI,EAAOxD,EAAK,CAAC,CACrG,CAEA,MAAMyH,EAAkB,CAAA,EAClBlB,EAAK,IAAId,GAAe,EAAEgC,CAAO,EAEjCC,EAAK,IAAIC,EACTC,EAAON,KACV,GAAA,CACGI,EAAA,UAAUG,EAAW,YAAY,EACtCH,EAAK,YAAYE,CAAM,EACvBF,EAAK,YAAYtE,CAAI,EACrBsE,EAAK,YAAYlE,CAAM,EACvBkE,EAAK,WAAW1H,EAAK8H,GAAGJ,EAAK,aAAaI,EAAEL,CAAO,CAAC,QAC9CtG,EAAE,CACG,OAAA4E,EAAA,IAAIQ,CAAI,IAAIpF,CAAC,EACjBoF,CACR,CAEA,OAAKzB,GAAc1B,GAAM,MAAM2E,GAAY,MAItCxB,EAAA,YAAY,IAAIyB,IAAU,CAC9B,GAAGzB,EAAK,SAAiB,OAAAA,EACnB,MAAA0B,EAAI,IAAIN,EACVM,EAAA,UAAUJ,EAAW,iBAAiB,EAC1CI,EAAI,YAAYL,CAAM,EACtB,MAAMM,EAAe,CAAA,EACrB,OAAAD,EAAI,WAAWD,EAAQF,GAAGG,EAAI,aAAaH,EAAEI,CAAI,CAAC,EAC1CT,EAAA,KAAK,GAAGS,CAAI,EAEpBC,EAAQF,CAAG,EACJ1B,CAAA,EAERA,EAAK,OAAO,IAAI,CACf,GAAGA,EAAK,SAAU,OACZ,MAAA0B,EAAI,IAAIN,EACVM,EAAA,UAAUJ,EAAW,cAAc,EACvCI,EAAI,YAAYL,CAAM,EAEtBO,EAAQF,CAAG,CAAA,EAEZ1B,EAAK,UAAU,IAAIxB,EAAmB,KAAK,IAAI6C,CAAM,EAE5CQ,GAAAR,EAAOrB,EAAKmB,CAAI,EAElBnB,IA3BNR,EAAW,IAAIQ,CAAI,IAAIjC,QAAmB,mBAAA,IAAI,eAAe,CAAC,EACvDiC,EA2BT,CAnDgBlI,EAAA0G,EAAA,sBAsDT,SAASsD,GAAa/C,EAAyC,CACrE,OAAOkC,GAAkBlC,EAAK,KAAK,KAAK,KAAK,CAAC,CAC/C,CAFgBjH,EAAAgK,GAAA,aAIhB,SAASb,GAAqBlC,EAA0BlC,EAAmBI,EAAqBxD,EAAkBuD,EAAY,CAC7H,MAAMwD,EAAQ,IAAItB,GAAelC,EAAK,CAAE,CAAA,EAElC+E,EAAW,IAAI,gBACfnB,EAA4B,CACjC,KAAA/D,EACA,OAAAI,EACA,YAAY,IAAI+E,KACPxB,EAAA,UAAUC,EAAkBD,EAAQwB,CAAO,EAC5CpB,GAER,IAAI,UAAU,CACb,OAAOJ,EAAQ,QAChB,EACA,QAAQA,EACR,mBAAoBzB,GAA6Be,EAAgBc,EAAQ7B,CAAI,EAC7E,YAAYgD,EAAW,OACvB,WAAW,IAAIA,EAAW,MAAM,EAChC,CAAC,OAAO,aAAa,EAAE,IAAIhC,EAAiBa,CAAO,CAAA,EAE5C,OAAAJ,EAAA,YAAY,IAAIyB,KACfzB,EAAA,UAAUC,EAAkBG,EAAQqB,CAAQ,EAC7CzB,GAERA,EAAQ,OAAO,IAAIA,EAAQ,UAAUI,EAAQ,aAG7CsB,GAAiBnD,EAAK6B,EAAQtB,EAAY,IAAIkB,CAAO,EAAEhB,EAAW,IAAIgB,CAAO,EAAE3D,EAAKI,EAAOxD,CAAI,EAExF+G,CACR,CA9BS1I,EAAAmJ,GAAA,qBAgCT,eAAsBiB,GAAoBnD,EAAW6B,EAA4BxB,EAAkCC,EACvGxC,EAAmBI,EAAqBxD,EAAkB,CAClE,GAAA,CACE,IAAAsB,EACJ,MAAM8F,EAAoCH,EAC3BA,EAAAE,EACZ,GAAA,CACF7F,EAAO,KAAQ,CACd,MAAM,oBAAoB,CACzB,OAAO,MAAMgE,EAAK,CACnB,CAAA,EACE,mBAAuB,CAAA,QAC1B,CACe2B,EAAAG,CAChB,CACAzB,IAAU,MAAMrE,CAAM,QAChBH,EAAE,CACCyE,IAAAzD,EACP,cAAchB,CAAU,EACxB,OAAOiC,EAAKI,EAAOxD,CAAI,CAAC,CAC3B,CACD,CArBsB3B,EAAAoK,GAAA,oBC3Gf,MAAMC,EAAY,cACfrK,EAAA,SAAoBiH,EAAe,CAAC,OAAO,OAAO,eAAeA,EAAK,WAAW,SAAS,CAAE,EAA5F,aAKW,OAAA,CAAAjH,EAAA,qBAEpB,YACiB+E,EACAI,EAChB,CAAC,MAAMuB,EAAmB,KAAK,KAAK3B,EAAKI,CAAM,CAAC,EAFhC,KAAA,KAAAJ,EACA,KAAA,OAAAI,CACkC,CAGnD,UAAU,CACT,MAAO,sBAAsB,KAAK,MAAM,MAAM,IAAI,KAAK,MAAM,aAC9D,CACD,EAEA,IAAI8D,GAAe,KAAK,MACxB,MAAMqB,OAAkB,QAEjB,SAASC,GAAkDtD,EAAwB,CACzF,GAAGA,aAAgBoD,EAAoB,OAAApD,EACjC,MAAAmC,EAAQkB,GAAc,IAAIrD,CAAI,EACpC,GAAGmC,GAAS,KAAK,OAAO,IAAIiB,EAAY,IAAI7E,EAAM4D,CAAO,EACnD,MAAAoB,GAAIvB,MAAU,SAAS,EAAE,EAE/B7C,GAAoBoE,CAAE,EAAEvD,EACVqD,GAAA,IAAIrD,EAAKuD,CAAE,EAEzB,MAAMzF,EAAK,IAAIS,EACR,OAAA,IAAI6E,EAAYtF,EAAKyF,CAAE,CAC/B,CAXgBxK,EAAAuK,GAAA,oBAaT,SAASE,GAAmBxD,EAAuB,CACzD,MAAMlC,EAAK,IAAIS,EACf,GAAGyB,EAAK,MAAMlC,EAAY,MAAA,IAAI,MAAM,kEAAkE,EAE/F,OAAAqB,GAAoBa,EAAK,MAAM,EACtCqD,GAAc,OAAOrD,CAAI,CAC1B,CANgBjH,EAAAyK,GAAA,sBC5CH,MAAAC,EAAc,OAAO,eAAe,EACpCC,EAAgB,OAAO,iBAAiB,EACxC7D,EAAoB,OAAO,qBAAqB,EAmBtD,SAAS8D,EAIf7F,EACAlF,EAAU,IAAI,KAAe,OAAA,CAAAG,EAAA,kBAAC,CAAC0K,CAAa,EAAE3F,CAAI,EACzB,CAEnB,MAAA8F,MAAU,IAGT,OAAA,IAAI,MAAoChL,EAAO,CACrD,IAAIiL,EAASpK,EAAwB,CACpC,GAAGA,GAAGgK,EAAsB,OAAA3F,EAC5B,GAAGrE,GAAGiK,EAAiB,MAAO,IAAIjE,EAAmB,KAAK,IAAI3B,CAAI,EAClE,GAAGrE,GAAGoG,EAAqB,MAAO,IAAIJ,EAAmB3B,EAAK,KAAK,GAAG,EACnE,GAAA,OAAOrE,GAAG,UACZA,GAAG,OACF,OAAab,EAAQa,CAAC,EACrB,GAAAmK,EAAM,IAAInK,CAAC,EAAU,OAAAmK,EAAM,IAAInK,CAAC,EAEnC,MAAMuG,EAAK,IAAIoD,EACdtF,EACArE,CAAA,EACK,OAAAmK,EAAA,IAAInK,EAAEuG,CAAI,EACTA,CACR,EACA,UAAUpH,EAAYkL,EAAwB,CACtC,OAAA,IAAIlL,EAAO,GAAGkL,CAAQ,CAC9B,EACA,IAAID,EAAQpK,EAA4B,CACvC,OAAOA,GAAGgK,GAAehK,GAAGoG,GAAqBpG,GAAGiK,GAAiBjK,KAAKb,CAC3E,CAAA,CACA,CACF,CAlCgBG,EAAA4K,EAAA,sBAqCT,MAAMI,GAAS,IAAI,MAAM,GAAG,CAClC,IAAI,CAACF,EAAEG,IAAO,OAAOA,GAAM,SAASL,EAAmBK,CAAI,EAAE,OAC7D,IAAI,CAACH,EAAEG,IAAO,OAAOA,GAAM,UAAUA,GAAM,MAC5C,CAAC,EC3DYC,GAAyH,CAAA,EACzHC,OAAiB,IAEd,SAAAC,GAAY3G,EAAgB2E,EAAmB,CAC1D,IAAAiC,EAAS5G,EAAK,aAElB,GAAG4G,EAAS,EAAE,CAEb,OADAA,EAAU,CAACA,EACJA,EAAS,EAAE,CACjB,IAAK,GACG,OAAAjC,EAAQiC,EAAS,CAAC,EAC1B,IAAK,GACG,OAAA,IAAI,cAAc,OAAO5G,EAAK,YAAY4G,EAAS,GAAG,CAAC,CAAC,EAChE,IAAK,GAAE,CACN,MAAMC,EAAsB,CAAA,EAC5BlC,EAAQ,KAAKkC,CAAC,EACd,QAAQ,EAAE,EAAG,GAAGD,EAAS,GAAG,EAAG,IAAI,CAC5B,MAAAtE,EAAItC,EAAK,aACf6G,EAAEvE,CAAI,EAAEqE,GAAY3G,EAAK2E,CAAO,CACjC,CACO,OAAAkC,CACR,CACA,IAAK,GAAE,CACN,MAAMA,EAAE,IAAI,OAAOD,EAAS,GAAG,CAAC,EAChCjC,EAAQ,KAAKkC,CAAC,EACd,QAAQ,EAAE,EAAG,EAAEA,EAAE,OAAQ,IAAKA,EAAE,CAAC,EAAEF,GAAY3G,EAAK2E,CAAO,EACpD,OAAAkC,CACR,CACD,CACM,MAAA,IAAI,MAAM,0BAA0B,CAAA,SAClCD,GAAU,IAAI,CAChB,MAAAtG,EAAK,IAAI,YAAY,EAAE,OAAON,EAAK,WAAW4G,EAAS,GAAG,CAAC,EAC3DE,EAAcJ,GAAa,IAAIpG,CAAI,EACtC,GAAAwG,EACK,OAAAA,EAAc9G,EAAK2E,CAAO,EAC5B,MAAA,IAAI,MAAM,sBAAsBrE,CAAI,CAAA,KAEnC,QAAA,OAAO,cAAcsG,CAAQ,EAAE,CACrC,IAAK,IACG,OAAA,KACR,IAAK,IACG,MAAA,GACR,IAAK,IACG,MAAA,GACR,IAAK,IACJ,OAAO5G,EAAK,UACb,IAAK,IACJ,OAAOA,EAAK,aACb,IAAK,IACJ,OAAOA,EAAK,WACb,IAAK,IACJ,OAAOA,EAAK,WAAWA,EAAK,WAAY,CAAA,EACzC,IAAK,IACJ,OAAO,IAAI,KAAK,OAAOA,EAAK,SAAA,CAAU,CAAC,EACxC,IAAK,IAAI,CACF,MAAA+G,EAAQ/G,EAAK,aACbgH,EAAMhH,EAAK,WAEjB,OAAO,IAAI,OAAO+G,EAAS,KACxBC,EAAM,EAAG,IAAK,KACdA,EAAM,EAAG,IAAK,GAAA,CAElB,CACA,IAAK,IACJ,OAAOhH,EAAK,YACb,IAAK,IACE,MAAAiH,EAAWjH,EAAK,aACtB,GAAGiH,GAAY,KAAY,MAAA,IAAI,MAAM,oBAAoB,EACzD,OAAOd,EAAmBc,CAAU,EACrC,IAAK,IACE,MAAA3G,EAAKN,EAAK,aAChB,GAAGM,GAAM,KAAY,MAAA,IAAI,MAAM,oBAAoB,EAC7C,MAAAI,EAAOV,EAAK,aAClB,GAAGU,GAAQ,KAAY,MAAA,IAAI,MAAM,sBAAsB,EACvD,MAAM8B,EAAK,IAAIoD,EAAYtF,EAAKI,CAAM,EACtC,OAAAiE,EAAQ,KAAKnC,CAAI,EACVA,EACR,QACO,MAAA,IAAI,MAAM,6BAA6BoE,CAAQ,CACvD,CAEF,CA9EgBrL,EAAAoL,GAAA,eAgFA,SAAAO,GAAa9G,EAAmB4E,EAAWL,EAAmB,CAC7E,GAAGK,GAAG,KAAM5E,EAAO,YAAY,GAAiB,UACxC4E,IAAI,GAAM5E,EAAO,YAAY,GAAiB,UAC9C4E,IAAI,GAAO5E,EAAO,YAAY,GAAiB,UAC/C,OAAO4E,GAAG,WAAWA,EAAE,KAAKA,EACnC5E,EAAO,YAAY,GAAiB,EACpCA,EAAO,SAAS4E,CAAC,UACT,OAAOA,GAAG,SAClB5E,EAAO,YAAY,GAAiB,EACpCA,EAAO,YAAY4E,CAAC,UACZ,OAAOA,GAAG,SAClB5E,EAAO,YAAY,GAAiB,EACpCA,EAAO,UAAU4E,CAAC,UACVA,aAAa,WACrB5E,EAAO,YAAY,EAAiB,EAC7BA,EAAA,YAAY4E,EAAE,MAAM,EAC3B5E,EAAO,YAAY4E,CAAC,UACZA,aAAa,KACrB5E,EAAO,YAAY,EAAiB,EAC7BA,EAAA,UAAU,CAAC4E,CAAC,UACXA,aAAa,OAAO,CAC5B5E,EAAO,YAAY,EAAiB,EAC7BA,EAAA,YAAY4E,EAAE,MAAM,EAC3B,MAAMgC,EAAMhC,EAAE,MACP5E,EAAA,WACL4G,EAAM,SAAS,GAAG,EAAE,EAAG,KACvBA,EAAM,SAAS,GAAG,EAAE,EAAG,EAAA,CACzB,SACQhC,aAAa,MACrB5E,EAAO,YAAY,EAAiB,EACpCA,EAAO,WAAW4E,CAAC,UACX,OAAOA,GAAI,UAAUiB,KAAiBjB,EAC9C5E,EAAO,YAAY,EAAiB,EAC7BA,EAAA,YAAa4E,EAAUiB,CAAa,CAAC,UACpC,OAAOjB,GAAI,WAAW,CAC9BL,EAAQ,KAAKK,CAAC,EACd5E,EAAO,YAAY,EAAiB,EAEhC,IAAA+G,EACDnC,aAAaY,EAAoBuB,EAAAnC,GAEnCmC,EAAQrB,GAAiBd,CAAQ,EACjCoC,GAAO,IAAIpC,EAAE,IAAIgB,GAAmBmB,CAAO,CAAC,GAGtC/G,EAAA,YAAY+G,EAAQ,IAAI,EACxB/G,EAAA,YAAY+G,EAAQ,MAAM,CAEzB,SAAAxC,EAAQ,SAASK,CAAC,EAC1B5E,EAAO,YAAY,EAAEuE,EAAQ,QAAQK,CAAC,EAAE,EAAU,UAC1C,OAAOA,GAAI,SAAS,CAC5B,MAAMqC,EAAO,IAAI,YAAY,EAAE,OAAOrC,CAAC,EACvC5E,EAAO,YAAY,EAAEiH,EAAO,OAAO,EAAE,EAAE,EACvCjH,EAAO,WAAWiH,CAAM,CACf,SAAA,MAAM,QAAQrC,CAAC,EAAE,CAC1BL,EAAQ,KAAKK,CAAC,EACd5E,EAAO,YAAY,EAAE4E,EAAE,OAAO,EAAE,EAAE,EAClC,QAAQsC,KAAWtC,EAAgBkC,GAAA9G,EAAOkH,EAAQ3C,CAAO,CAAA,KACrD,CACJ,OAAQ,CAACoB,EAAGwB,EAAMC,CAAK,IAAKf,GAAc,CACtC,GAAA,CAACc,EAAMvC,CAAC,EAAG,SACd,MAAMyC,EAAQ,IAAI,YAAY,EAAE,OAAO1B,CAAE,EAClC3F,EAAA,YAAYqH,EAAQ,OAAO,GAAG,EACrCrH,EAAO,WAAWqH,CAAO,EACnBD,EAAApH,EAAO4E,EAAEL,CAAO,EACtB,MACD,CAEG,GAAA,OAAOK,GAAI,SAAS,CACtBL,EAAQ,KAAKK,CAAC,EACR,MAAA0C,EAAQ,OAAO,QAAQ1C,CAAC,EAC9B5E,EAAO,YAAY,EAAEsH,EAAQ,OAAO,EAAE,EAAE,EACxC,OAAQ,CAACpF,EAAIqF,CAAK,IAAKD,EACtBtH,EAAO,YAAYkC,CAAG,EACT4E,GAAA9G,EAAOuH,EAAMhD,CAAO,CAEnC,KAAY,OAAA,IAAI,MAAM,oBAAoBK,CAAC,CAC5C,CACD,CA9EgBzJ,EAAA2L,GAAA,gBAgFhB,MAAME,OAAW,QACV,SAASlE,GAAYyB,EAAkB,CAC7C,QAAQ2C,KAAW3C,EACXyC,GAAA,IAAIE,CAAO,KACpB,CAHgB/L,EAAA2H,GAAA,eCrKT,MAAM2B,CAAU,OAAA,CAAAtJ,EAAA,mBACd,KACA,MACA,OAAc,EAEtB,YAAYqM,EAAyB,GAAG,CACvC,KAAK,KAAK,OAAOA,GAAO,SAAS,IAAI,WAAWA,CAAI,EAAEA,EACtD,KAAK,MAAM,IAAI,SAAS,KAAK,KAAK,MAAM,CACzC,CAEQ,eAAeC,EAAkB,CAErC,GADHA,GAAY,KAAK,OACdA,EAAW,KAAK,KAAK,WAAW,CAC9B,IAAAC,EAAY,IAAI,WAAW,KAAK,IAAI,KAAK,KAAK,WAAW,EAAED,CAAU,CAAC,EAC1E,KAAK,MAAM,IAAI,SAASC,EAAY,MAAM,EAE9BA,EAAA,IAAI,KAAK,IAAI,EACzB,KAAK,KAAKA,CACX,CACD,CAEA,UAAUC,EAAc,CACvB,KAAK,eAAe,CAAC,EAChB,KAAA,KAAK,KAAK,MAAM,EAAEA,EAClB,KAAA,QACN,CAEA,WAAWA,EAAyB,CAC9B,KAAA,eAAeA,EAAE,MAAM,EAC5B,KAAK,KAAK,IAAIA,EAAE,KAAK,MAAM,EAC3B,KAAK,QAAQA,EAAE,MAChB,CAEA,YAAYC,EAAoB,CAC/B,KAAK,WAAWA,CAAG,CACpB,CAEA,aAAaD,EAAe,CACtB,KAAA,UAAUA,EAAE,EAAE,CAAC,CACrB,CAEA,iBAAiBA,EAAsB,CACtC,KAAK,UAAUA,GAAG,KAAK,EAAEA,EAAE,EAAE,CAAC,CAC/B,CAEA,WAAWlM,EAAc,CACxB,KAAK,eAAe,CAAC,EACrB,KAAK,MAAM,SAAS,KAAK,OAAOA,CAAC,EACjC,KAAK,QAAQ,CACd,CAEA,UAAUoM,EAAc,CACvB,KAAK,WAAWA,EAAE,WAAW,CAAC,CAAC,CAChC,CAEA,SAASpM,EAAc,CACtB,KAAK,eAAe,CAAC,EACrB,KAAK,MAAM,SAAS,KAAK,OAAOA,CAAC,EACjC,KAAK,QAAQ,CACd,CAEA,UAAUA,EAAuB,CAC7B,OAAOA,GAAI,UACR,KAAA,SAASA,EAAG,GAAG,EAAG,EAClB,KAAA,SAASA,EAAG,GAAG,EAAG,IAEvB,KAAK,SAAS,OAAOA,EAAE,OAAO,GAAG,EAAE,CAAC,CAAC,EACrC,KAAK,SAAS,OAAOA,EAAE,OAAO,GAAG,EAAE,CAAC,CAAC,EAEvC,CAEA,WAAWA,EAAc,CACxB,KAAK,eAAe,CAAC,EACrB,KAAK,MAAM,WAAW,KAAK,OAAOA,CAAC,EACnC,KAAK,QAAQ,CACd,CAEA,YAAYA,EAAc,CACzB,KAAK,eAAe,CAAC,EACrB,KAAK,MAAM,WAAW,KAAK,OAAOA,CAAC,EACnC,KAAK,QAAQ,CACd,CAEA,YAAYkD,EAAgB,CAC3B,GAAGA,GAAG,KAAK,CACV,KAAK,YAAY,EAAE,EACnB,MACD,CACA,IAAImJ,EAAM,IAAI,YAAY,EAAE,OAAOnJ,CAAC,EAC/B,KAAA,YAAYmJ,EAAM,MAAM,EAC7B,KAAK,WAAWA,CAAK,CACtB,CAEA,YAAYxL,EAAS,CACpB,IAAIyL,GAAGzL,EAAE,EAAE,CAACA,EAAEA,KAAK,EACnB,KAAMyL,GAAG,KACH,KAAA,UAAUA,EAAE,GAAI,EACjBA,IAAA,EAEFzL,EAAE,GACC,KAAA,UAAUyL,EAAE,GAAI,EACrB,KAAK,UAAU,CAAC,GAEhB,KAAK,UAAUA,CAAC,CAElB,CAEA,eAAeC,EAA6B,CACvCA,GAEE,KAAA,YAAYA,EAAI,MAAM,EAC3B,KAAK,WAAWA,CAAG,GAHX,KAAK,YAAY,EAAE,CAK7B,CAEA,WAAcA,EAAwBC,EAA0B,CAC/D,GAAG,CAACD,EAAK,KAAK,YAAY,EAAE,MACxB,CACE,KAAA,YAAYA,EAAI,MAAM,EAC3B,QAAQ1L,EAAE,EAAGA,EAAE0L,EAAI,OAAQ1L,IAC1B2L,EAAc,KAAK,KAAKD,EAAI1L,CAAC,CAAE,CACjC,CACD,CAEA,SAASmD,EAAK,EAAa,CAC1B,OAAO,KAAK,KAAK,MAAMA,EAAK,KAAK,OAAOA,CAAI,CAC7C,CAEA,WAAWlC,EAAY,CACnB,GAAA,CACI,MAAA0B,EAAS,cAAc1B,CAAK,QAC5BU,EAAE,CACPA,EAAe,MAAM,IAAI,CAC3B,CACD,CAEA,aAAasJ,EAAUhD,EAAkB,GAAG,CAC9BuC,GAAA,KAAKS,EAAMhD,CAAO,CAChC,CACD,CC5HA,MAAM2D,MAAmB,IACnBC,MAAuB,IAEtB,SAASC,GAAkBnK,EAAQ,CACjC,QAAA4F,KAAWqE,EAAe,OAAO,EAAcrF,EAAA,IAAIgB,CAAO,IAAI5F,CAAC,EACvEiK,EAAe,MAAM,EAEb,QAAAG,KAAOF,EAAmB,OAAO,EAAGE,EAAI,WAAW,CAC5D,CALgBlN,EAAAiN,GAAA,qBAOT,SAASnD,EAAQT,EAAgB,CACvC,GAAGK,GAAY,KAAY,MAAAzD,QAAA,mBAAmB,IAAI,eAAe,EACtDyD,EAAA,KAAKL,EAAK,SAAU,CAAA,CAChC,CAHgBrJ,EAAA8J,EAAA,WAKA,SAAAC,GAASR,EAAcrB,EAAiBmB,EAAgB,CACxD0D,EAAA,IAAIxD,EAAOrB,CAAI,EAC3B,GAAA,CACF4B,EAAQT,CAAI,QACNvG,EAAE,CACG4E,EAAA,IAAIQ,CAAI,IAAIpF,CAAC,CACzB,CACD,CAPgB9C,EAAA+J,GAAA,YASJ,IAAAP,GAAAA,IACXA,EAAAA,EAAA,aAAa,CAAb,EAAA,eACAA,EAAAA,EAAA,gBAAgB,CAAhB,EAAA,kBACAA,EAAAA,EAAA,cAAc,CAAd,EAAA,gBACAA,EAAAA,EAAA,eAAe,CAAf,EAAA,iBACAA,EAAAA,EAAA,kBAAkB,CAAlB,EAAA,oBACAA,EAAAA,EAAA,gBAAgB,CAAhB,EAAA,kBANWA,IAAAA,GAAA,CAAA,CAAA,EASZ,eAAsB2D,GAAW1I,EAAe,CACzC,MAAA2I,EAAW3I,EAAK,WAEtB,OAAO2I,EAAW,CACjB,IAAK,GAAwB,CACtB,MAAA7D,EAAO9E,EAAK,aAGZ2E,EAAkB,CAAA,EAExB,IAAIiE,EAAiB,GACjB/F,EAA0B,KAC1BC,EAAuB,KAE3B,MAAM+F,EAAQ,IAAI,QAAQ,CAAChF,EAAIiF,IAAM,CACpCjG,EAAQtH,EAAGyH,GAAA,CACVa,EAAIb,CAAC,EACI4F,EAAA,GAEH,MAAAhE,EAAK,IAAIC,EACfD,EAAK,UAAU,GACfA,EAAK,YAAYE,CAAM,EACvBF,EAAK,aAAa5B,CAAC,EACnBqC,EAAQT,CAAI,EACZ2D,EAAmB,OAAOzD,CAAM,EAEhC5B,GAAYyB,CAAO,CAAA,EAXZ,WAaR7B,EAAOvH,EAAG8C,GAAA,CACTyK,EAAIzK,CAAC,EACIuK,EAAA,GAEH,MAAAhE,EAAK,IAAIC,EACfD,EAAK,UAAU,GACfA,EAAK,YAAYE,CAAM,EACvBF,EAAK,WAAWvG,CAAC,EACjBgH,EAAQT,CAAI,EACZ2D,EAAmB,OAAOzD,CAAM,EAEhC5B,GAAYyB,CAAO,CAAA,EAXb,SAYP,CACA,EACDkE,EAAQ,MAAM,IAAI,CAAA,CAAE,EAGjB,GAAA,CACI,MAAAvI,EAAKN,EAAK,aAEhB,GAAGM,GAAM,KACF,MAAAY,QAAA,qBAAqB,IAAI,IAAI,EAC9B,MAAAuD,EAAM7C,EAAgB,IAAItB,CAAI,EACpC,GAAG,CAACmE,EACG,MAAAvD,QAAA,qBAAqB,IAAIZ,CAAI,EAE9B,MAAAI,EAAOV,EAAK,aAEZ9C,EAAK8C,EAAK,UAAU,IAAIA,EAAK,YAAY2E,CAAO,CAAC,GAAG,GAGpDa,EAAW,IAAI,gBACfnB,EAA4B,CACjC,KAAA/D,EACA,OAAAI,EACA,IAAI,UAAU,CACN,OAAAkI,CACR,EACA,QAAAC,EACA,eAAepD,EAAQ,CACnB,GAAAmD,EAAiB,OAAAvE,EACd,MAAAc,EAAI,IAAIN,EACdM,EAAI,UAAU,GACdA,EAAI,YAAYL,CAAM,EACtB,MAAMM,EAAe,CAAA,EACrB,OAAAD,EAAI,WAAWM,EAAQT,GAAGG,EAAI,aAAaH,EAAEI,CAAI,CAAC,EAC1CT,EAAA,KAAK,GAAGS,CAAI,EAEpBC,EAAQF,CAAG,EACJd,CACR,EACA,mBAAmB7B,EAA2B,CAC7C,OAAAe,EAAgBc,EAAQ7B,CAAI,EACrB6B,CACR,EACA,YAAYmB,EAAW,OACvB,WAAW,IAAIA,EAAW,MAAM,EAChC,CAAC,OAAO,aAAa,EAAE,IAAIhC,EAAiBa,CAAO,CAAA,EAEjCkE,EAAA,IAAIzD,EAAOT,CAAO,EAGrC,MAAMsB,GAAiBpD,GAAO,KAAK,KAAKkC,EAAMnE,EAAKI,EAAO,GAAGxD,CAAI,EAAEmH,EAAQxB,EAAQC,EAAOxC,EAAKI,EAAOxD,CAAI,QACpGmB,EAAE,CACHA,aAAagB,IACjBhB,EAAEqD,QAAAA,aAAa,IAAI,gCAAgCqD,EAAW4D,CAAU,CAAC,IAAItK,CAAU,GACxFyE,EAAOzE,CAAU,CAClB,CACA,KACD,CACA,IAAK,GAA2B,CACzB,MAAAyG,EAAO9E,EAAK,aAEZiE,EAAQqE,EAAe,IAAIxD,CAAM,EACvC,GAAGb,GAAS,KAAK,CAChB,QAAQ,KAAK,0BAA0Ba,CAAM,MAAMC,EAAW4D,CAAU,CAAC,GAAG,EAC5E,KACD,CACG,GAAA,CACF5F,EAAY,IAAIkB,CAAO,IAAIjE,EAAK,YAAa,CAAA,QACvC3B,EAAE,CACG4E,EAAA,IAAIgB,CAAO,IAAIvC,QAAAA,aAAa,IAAI,gCAAgCqD,EAAW4D,CAAU,CAAC,IAAItK,CAAU,CAAC,CAAA,QAChH,CACAiK,EAAe,OAAOxD,CAAM,CAC7B,CACA,KACD,CACA,IAAK,GAAyB,CACvB,MAAAA,EAAO9E,EAAK,aAEZiE,EAAQqE,EAAe,IAAIxD,CAAM,EACvC,GAAGb,GAAS,KAAK,CAChB,QAAQ,KAAK,0BAA0Ba,CAAM,MAAMC,EAAW4D,CAAU,CAAC,GAAG,EAC5E,KACD,CAEG,GAAA,CACE,IAAAI,EACD,GAAA,CACFA,EAAI/I,EAAK,kBACH3B,EAAE,CACR0K,EAAIrH,QAAAA,aAAa,IAAI,gCAAgCqD,EAAW4D,CAAU,CAAC,IAAItK,CAAU,CAC1F,CACM,MAAA0K,QACA1K,EAAE,CACG4E,EAAA,IAAIgB,CAAO,IAAI5F,CAAC,CAAA,QAC3B,CACAiK,EAAe,OAAOxD,CAAM,CAC7B,CACA,KACD,CACA,IAAK,GAA0B,CACxB,MAAAA,EAAO9E,EAAK,aACd,IAAAyI,EAAIF,EAAmB,IAAIzD,CAAM,EACrC,GAAG,CAAC2D,EAAI,CACP,QAAQ,KAAK,+BAA+B3D,CAAM,MAAMC,EAAW4D,CAAU,CAAC,GAAG,EACjF,KACD,CACAF,EAAI,WAAW,EACf,KACD,CACA,IAAK,GAA6B,CAC3B,MAAA3D,EAAO9E,EAAK,aACd,IAAAyI,EAAIF,EAAmB,IAAIzD,CAAM,EACrC,GAAG,CAAC2D,EAAI,CACP,QAAQ,KAAK,+BAA+B3D,CAAM,MAAMC,EAAW4D,CAAU,CAAC,GAAG,EACjF,KACD,CACA,MAAMhE,EAAkB,CAAA,EAClBzH,EAAK8C,EAAK,UAAU,IAAIA,EAAK,YAAY2E,CAAO,CAAC,GAAG,GAC1DT,EAAkBuE,EAAIvL,CAAI,EAC1B,KACD,CACA,IAAK,GAA2B,CACzB,MAAA4H,EAAO9E,EAAK,aACd,IAAAiE,EAAQqE,EAAe,IAAIxD,CAAM,EACrC,GAAG,CAACb,EAAQ,CACX,QAAQ,KAAK,0BAA0Ba,CAAM,MAAMC,EAAW4D,CAAU,CAAC,GAAG,EAC5E,KACD,CACA,MAAMhE,EAAkB,CAAA,EAClBzH,EAAK8C,EAAK,UAAU,IAAIA,EAAK,YAAY2E,CAAO,CAAC,GAAG,GAC1DT,EAAkBD,EAAQ/G,CAAI,EAC9B,KACD,CACD,CACD,CA9KsB3B,EAAAmN,GAAA,cChDf,MAAMM,EAAS,OAAA,CAAAzN,EAAA,kBACJ,KACA,MACT,KACS,OAIjB,YAAYyM,EAAgBiB,EAAY,EAAEC,EAAelB,EAAI,OAAO,CACnE,KAAK,KAAKA,EACV,KAAK,MAAM,IAAI,SAASA,EAAI,MAAM,EAClC,KAAK,KAAKiB,EACV,KAAK,OAAOA,EAAIC,CACjB,CAEA,UAAUnB,EAAYoB,EAAY,EAAE1K,EAAYsJ,EAAE,OAAa,CAC9D,IAAIkB,EAAI,KAAK,KAGb,GAFgB,KAAK,OAAOA,EAEfxK,EAAW,MAAA,IAAI,WAAW,6CAA6C,EAEpF,QAAQ/B,EAAEyM,EAAKzM,EAAEyM,EAAI1K,EAAK/B,IACzBqL,EAAErL,CAAC,EAAE,KAAK,KAAKuM,GAAK,EACrB,KAAK,KAAKA,CACX,CAEA,KAAKpN,EAAkB,CAClB,IAAAyB,EAAE,KAAK,YACX,OAAGzB,EAAEyB,IAAKA,EAAAzB,EAAE,EAAE,EAAGA,GACjB,KAAK,MAAMyB,EACJA,CACR,CAEA,WAAmB,CACX,OAAA,KAAK,OAAO,KAAK,IACzB,CAEA,SAAqB,CACb,OAAA,KAAK,KAAK,MAAM,KAAK,KAAK,KAAK,KAAK,KAAK,MAAM,CACvD,CAEA,WAAW4L,EAA2B,CAClC,GAAAA,EAAO,KAAK,UAAU,EAAG,MAAM,IAAI,WACtC,OAAO,KAAK,KAAK,MAAM,KAAK,KAAK,KAAK,MAAMA,CAAM,CACnD,CAEA,UAAkB,CACjB,OAAO,KAAK,MAAM,SAAS,KAAK,MAAM,CACvC,CAEA,aAAsB,CACd,OAAA,KAAK,SAAY,GAAA,CACzB,CAEA,iBAAiC,CAC1B,MAAAnB,EAAE,KAAK,WACN,OAAAA,EAAE,EAAEA,GAAG,EAAG,IAClB,CAEA,WAAmB,CAClB,MAAMlM,EAAE,KAAK,MAAM,SAAS,KAAK,IAAI,EACrC,YAAK,MAAM,EACJA,CACR,CAEA,YAAoB,CACnB,MAAMA,EAAE,KAAK,MAAM,UAAU,KAAK,IAAI,EACtC,YAAK,MAAM,EACJA,CACR,CAEA,UAAkB,CACjB,OAAO,OAAO,aAAa,KAAK,WAAY,CAAA,CAC7C,CAEA,SAAiB,CAChB,MAAMA,EAAE,KAAK,MAAM,SAAS,KAAK,IAAI,EACrC,YAAK,MAAM,EACJA,CACR,CAEA,UAAkB,CACjB,OAAO,OAAO,KAAK,QAAS,CAAA,EAAE,OAAO,GAAG,EAAE,EAAE,OAAO,KAAK,YAAY,CAAC,CACtE,CAEA,WAAmB,CAClB,MAAMA,EAAE,KAAK,MAAM,WAAW,KAAK,IAAI,EACvC,YAAK,MAAM,EACJA,CACR,CAEA,YAAoB,CACnB,MAAMA,EAAE,KAAK,MAAM,WAAW,KAAK,IAAI,EACvC,YAAK,MAAM,EACJA,CACR,CAEA,YAAyB,CACpB,IAAAqN,EAAO,KAAK,aAChB,OAAGA,GAAS,GAAW,KAChB,IAAI,YAAY,EAAE,OAAO,KAAK,WAAWA,CAAM,CAAC,CACxD,CAEA,YAAoB,CACnB,IAAI1K,EAAO,EACP4K,EAAK,EACT,OAAW,CACJ,MAAAC,EAAK,KAAK,WAChB,GAAGA,GAAM,EAAU,OAAAD,GAAM,EAAE,EAAG,CAAC5K,EAC3B,GAAA,EAAA6K,EAAK,KACR,OAAA7K,GAAQ6K,GAAMD,EACP5K,EAERA,IAAS6K,EAAK,MAAOD,EACfA,GAAA,CACP,CACD,CAEA,UAAaE,EAA8B,CACpC,MAAAJ,EAAO,KAAK,aAClB,GAAGA,GAAS,GAAW,OAAA,KACvB,MAAMd,EAAS,CAAA,EACP,QAAA,EAAE,EAAG,EAAEc,EAAQ,IACtBd,EAAI,CAAC,EAAEkB,EAAa,KAAK,IAAI,EACvB,OAAAlB,CACR,CAEA,WAAW,CACH,OAAA/I,EAAS,KAAK,IAAI,CAC1B,CAEA,YAAYsF,EAAmB,GAAG,CAC1B,OAAAgC,GAAY,KAAKhC,CAAO,CAChC,CACD,CChIO,IAAI3C,EAAY,GAGnBuH,GAAuCC,GACvCC,GAA0B,IAAI,QAAc,CAAC5F,EAAIiF,IAAM,CAACS,GAA0BC,EAAwB,EAAE,CAAC3F,EAAIiF,CAAG,CAAC,EACzHW,GAA0B,MAAM,IAAI,CAAC,CAAC,EAEtC,eAAsBC,IAAe,CAC9B,OACL,GAAG,MAAMD,GAA0B,KAAK,IAAI,GAAK,IAAI,EAAK,EACzD,MACH,CAJsBlO,EAAAmO,GAAA,iBAMtB,IAAIC,EACJ,GAAG/I,GAAS,CACX,MAAMgJ,EAAQ,YAAa,WAAY,WAAmB,QAAW,QAAQ,IAAI,QAC3EC,EAAU,cAAe,WAAY,WAAmB,UAAa,QAAQ,IAAI,UACnFD,EAIHD,EAAgBpO,EAAA,MAAMuO,GAAQ,CACvB,MAAAC,EAAI,IAAI,IAAIH,CAAO,EACrBG,EAAA,OAAOD,EAAM,WACX,MAAAE,EAAiC,YAAa,WAAW,WAAW,QAAW,IAAI,GAAG,KAAM,QAAO,IAAI,GAAG,UAEhH,OAAO,IAAIA,EAAGD,EAAIF,GAAW,KAAK,CAAA,EAAG,CACpC,QAAQ,CACP,OAAO,aAAaA,CACrB,CAAA,CACA,CAAA,EATc,oBAHhB,QAAQ,KAAK,sDAAsD,EACnEF,EAAgBpO,EAAA,UAAU,CAAA,GAAV,mBAalB,SAAS,aAAc,WACtBoO,EAAgBpO,EAAA,MAAMuO,GAAQ,IAAI,UAAU,KAAK,SAAS,SAAS,OAAO,UAAU,CAAC,EAAE,QAAQA,CAAK,EAApF,uBACb,CACH,MAAMF,EAAQ,YAAa,WAAY,WAAmB,QAAW,QAAQ,IAAI,QAC3EC,EAAU,cAAe,WAAY,WAAmB,UAAa,QAAQ,IAAI,UACnFD,EAIHD,EAAgBpO,EAAA,MAAMuO,GAAQ,CACvB,MAAAC,EAAI,IAAI,IAAIH,CAAO,EACrB,OAAAG,EAAA,OAAOD,EAAM,WACV,IAAI,UAAUC,EAAIF,GAAW,KAAK,CAAA,EAAG,CAC3C,QAAQ,CACP,OAAO,aAAaA,CACrB,CAAA,CACO,CAAA,EAPO,oBAHhB,QAAQ,KAAK,sDAAsD,EACnEF,EAAgBpO,EAAA,UAAU,CAAA,GAAV,mBAWlB,CAGA,SAAS0O,GAAS5L,EAAQ,CACzB,MAAMyE,EAAO0G,GACbC,GAA0B,IAAI,QAAc,CAAC5F,EAAIiF,IAAM,CAACS,GAA0BC,EAAwB,EAAE,CAAC3F,EAAIiF,CAAG,CAAC,EACrHW,GAA0B,MAAM,IAAI,CAAA,CAAE,EACtC3G,EAAOzE,CAAC,EAERmK,GAAkBnK,CAAC,CACpB,CAPS9C,EAAA0O,GAAA,YAaF,IAAIhF,EAA4B,KAGvC,eAAsBiF,GAAYC,EAAuB,CACxD,IAAIC,EAAaC,EACbC,MAAkB,IAEhB,MAAAR,EAAM,IAAI,gBACVA,EAAA,IAAI,KAAK/I,CAAK,EACNuJ,EAAA,IAAI,IAAIvJ,CAAK,EAExBqJ,GAAc,MACVN,EAAA,IAAI,OAAOM,CAAY,EAEtB,QAAA9H,KAAOV,EAAgB,KAAK,EAC/B0I,EAAc,IAAIhI,CAAG,IACxBgI,EAAc,IAAIhI,CAAG,EACfwH,EAAA,OAAO,OAAOxH,CAAG,GAInB,MAAAiI,EAAU,MAAMZ,EAAgBG,CAAK,EAE3CS,EAAU,QAAQ,IAAI,CACrB,WAAWJ,EAAU,GAAI,EAErBlF,IACOA,EAAA,KACCjD,EAAA,GACZ,QAAQ,KAAK,2BAA2B,EACxCiI,GAASzI,QAAmB,mBAAA,IAAI,wBAAwBvB,EAAI,UAAU,CAAC,EAAA,EAExEsK,EAAU,OAAO,SAAS,CACzB,QAAQ,KAAK,wBAAwB,EAElC,GAAA,CACStF,EAAAsF,EAEX,MAAMC,EAAW,IAAI,IAAI5I,EAAgB,KAAM,CAAA,EACzC6I,EAAS,IAAI,IAAIH,CAAa,EAEpC,QAAQhK,KAAQkK,EACZC,EAAS,OAAOnK,CAAI,GACtBkK,EAAW,OAAOlK,CAAI,EAErBkK,EAAW,MAAMC,EAAS,KACzBJ,GAASD,EAAc,MAAMnI,EAAmB,KAAK,IAAIoI,EAAQ,CAAC,GAAGG,EAAW,KAAK,CAAC,EAAE,CAAC,GAAGC,EAAS,KAAA,CAAM,CAAC,EAC1G,MAAMxI,EAAmB,KAAK,IAAI,CAAC,GAAGuI,EAAW,KAAM,CAAA,EAAE,CAAC,GAAGC,EAAS,KAAA,CAAM,CAAC,EAC3EJ,GAASD,GAAoB,MAAAnI,EAAmB,KAAK,IAAIoI,CAAO,EAE5DrI,EAAA,GACcuH,WAGpBlL,EAAQ,CACN,QAAA,MAAM,kCAAkCA,CAAC,EACjD4L,GAAS5L,CAAC,EAECkM,GAAA,MAAM,IAAK,yBAAyB,EAC/C,MACD,CAAA,EAGDA,EAAU,WAAW,cACXA,EAAA,UAAWlM,GAAiB,CACrC,MAAM2B,EAAK3B,EAAE,KACV,OAAO2B,GAAM,SAAkB,QAAA,IAAI,2BAA2BA,CAAI,EAChE0I,GAAW,IAAIM,GAAU,IAAI,WAAWhJ,CAAI,CAAC,CAAC,EACjD,MAAM3B,GAAG,QAAQ,KAAK,gCAAgCA,CAAC,CAAC,CAAA,CAE5D,CAnEsB9C,EAAA2O,GAAA,eAqErB3O,EAAA,gBAA4B,CAItB,IAHN,MAAM,QAAQ,YAIb,MAAM,IAAI,QACTsH,GAASqH,GAAYrH,CAAO,CAAA,CAC/B,EAPC,eAOC,ECvJK,IAAIwH,EAAoB,KAE/B,eAAsBK,GAAQC,EAAiB,CACtCN,EAAAM,EACL,GAAA,CACC3I,GAAmB,MAAAC,EAAmB,KAAK,IAAI0I,CAAI,QAChD,EAAE,CACR,QAAQ,MAAM,iCAAiCA,CAAI,KAAK,CAAC,CAC1D,CACD,CAPsBpP,EAAAmP,GAAA,WCQf,SAASE,GAAkB7E,EAAW,CAC5C,OAAO,SAA8C3K,EAA6B,CACjFqL,GAAc,KAAK,CAACV,EAAGf,GAAGA,aAAa5J,EAAO,CAAC4E,EAAK6G,EAAElC,IAAWkC,EAAQ,MAAM7G,EAAK2E,CAAO,CAAC,CAAC,EAChF+B,GAAA,IAAIX,EAAG,CAAC/F,EAAK2E,IAAUvJ,EAAO,KAAK4E,EAAK2E,CAAO,CAAC,CAAA,CAE/D,CALgBpJ,EAAAqP,GAAA,qBCZT,SAASC,GAAYvK,EAAc,CAClC,OAAClF,GAAc,KAAK0G,GAAaxB,GAAMlF,EAAO,UAAU,YAAY,KAAKA,CAAM,CACvF,CAFgBG,EAAAsP,GAAA,eCmChB,QAAA,QAAA,EAAA,KAAA,IAAAC,EAAA,EAAmB,KAAMC,GAAI,OAAO,OAAO,WAAWA,CAAC,CAAC,EAGjD,MAAM9K,CAAG,CAGf,OAAuB,GAAUc,EAEjC,WAAkB,YAAmB,CAC7B,OAAAd,EAAI,MAAM,KAAK,GAAGA,EAAI,IAAI,KAAKA,EAAI,EAAE,IAAIA,EAAI,EACrD,CAEA,WAAkB,MAAoB,CAC9B,OAAAoK,CACR,CAEA,OAAc,QAAQK,GAGtB,WAAkB,aAAqB,CAC/B,OAAA1I,CACR,CAEA,WAAkB,oBAAkC,CACnD,OAAO0H,GAAc,CACtB,CAGA,OAAc,aAAavD,EAC3B,OAAc,eAAe,CAAI7F,EAAYI,IAAgB,IAAIkF,EAAetF,EAAKI,CAAM,EAC3F,OAAc,iBAAiBoF,GAC/B,OAAc,mBAAmBE,GAEjC,OAAc,UAAUT,GACxB,OAAc,aAAatD,EAE3B,OAAc,WAAmCsC,GACjD,OAAc,eAAeH,GAG7B,OAAc,aAAatC,GAC3B,OAAc,eAAeI,GAC7B,OAAc,iBAAiBL,GAG/B,OAAc,sBAAsB,MAAMvB,KAAe0K,IAAiC,MAAM/I,EAAmB,MAAM,wBAAwB3B,EAAK,GAAG0K,CAAK,EAC9J,OAAc,WAAW,SAASA,IAAiC,MAAM/I,EAAmB,MAAM,aAAa,GAAG+I,CAAK,EACvH,OAAc,UAAU,MAAM1K,GAA+B,MAAM2B,EAAmB,MAAM,YAAY3B,CAAI,EAC5G,OAAc,YAAY,SAA2B,MAAM2B,EAAmB,MAAM,aAAa,EACjG,OAAc,kBAAkB,SAA2B,MAAMA,EAAmB,MAAM,mBAAmB,EAC7G,OAAc,iBAAiB,MAAMgJ,EAAsB,KAA2C,MAAMhJ,EAAmB,MAAM,mBAAmBgJ,CAAa,EACrK,OAAc,WAAW,MAAMC,GAAiC,MAAMjJ,EAAmB,MAAM,aAAaiJ,CAAU,EACtH,OAAc,WAAW,MAAMA,GAAoC,MAAMjJ,EAAmB,MAAM,aAAaiJ,CAAU,EACzH,OAAc,YAAY,IAAgBjJ,EAAmB,MAAM,aAAa,EAEhF,OAAc,KAAKsE,GAEnB,OAAc,KAAKN,EAEnB,OAAc,OAAOC,EAErB,OAAc,WAAW7D,EAEzB,OAAc,iBAAkBwE,IAAsB,OAAOA,GAAI,SAASV,EAAmBU,CAAC,EAAEA,GAAGxE,CAAmB,EAAE,EACxH,OAAc,gBAAiBwE,IAAsB,OAAOA,GAAI,SAASV,EAAmBU,CAAC,EAAEA,GAAGX,CAAe,EAAE,EACnH,OAAc,cAAeW,GAAcA,EAAEZ,CAAa,CAC3D","x_google_ignoreList":[1,2]}