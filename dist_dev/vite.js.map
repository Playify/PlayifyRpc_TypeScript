{"version":3,"file":"vite.js","sources":["../src/vite.ts"],"sourcesContent":["// noinspection JSUnusedGlobalSymbols\r\n\r\nimport {Alias,AliasOptions,PluginOption,TransformResult} from \"vite\";\r\n\r\n\r\nexport const playifyRpcPlugin=(devRpcServer: string=\"http://127.0.0.1:4590\",rpcToken:string|undefined=process.env.RPC_TOKEN): PluginOption=>({\r\n\tname:\"playify-rpc\",\r\n\r\n\ttransform(code,_,cfg): TransformResult | undefined{\r\n\t\tif(!cfg?.ssr) return;\r\n\t\tconst importStatement='import \"/rpc.js\"';\r\n\t\tif(!code.includes(importStatement)) return;\r\n\t\treturn {\r\n\t\t\tcode:code.replaceAll(importStatement,\"\"),\r\n\t\t\tmap:null,\r\n\t\t};\r\n\t},\r\n\tconfig(config,cfg){\r\n\t\t//Rollup external\r\n\t\tconst rollupOptions=(config.build??={}).rollupOptions??={};\r\n\t\tlet external=rollupOptions.external;\r\n\t\tif(Array.isArray(external))external.push(\"/rpc.js\");\r\n\t\telse if(typeof external===\"function\"){\r\n\t\t\tconst old=external;\r\n\t\t\texternal=(s,...rest)=>s==\"/rpc.js\"||old(s,...rest);\r\n\t\t}else if(external!=null) external=[external,\"/rpc.js\"];\r\n\t\telse external=[\"/rpc.js\"];\r\n\t\trollupOptions.external=external;\r\n\t\trollupOptions.makeAbsoluteExternalsRelative=false;\r\n\r\n\t\t//Prevent from being included as code\r\n\t\tconst ssrExternal=(config.ssr??={}).external??=[];\r\n\t\tif(ssrExternal!=true)ssrExternal.push(\"playify-rpc\",\"/rpc.js\");\r\n\t\t((config.optimizeDeps??={}).exclude??=[]).push(\"playify-rpc\",\"/rpc.js\");\r\n\r\n\t\t//Proxy\r\n\t\t((config.server??={}).proxy??={})[\"/rpc\"]??={\r\n\t\t\ttarget:devRpcServer,\r\n\t\t\tchangeOrigin:true,\r\n\t\t\tws:true,\r\n\t\t\tprependPath:false,\r\n\t\t\theaders:rpcToken==null?undefined:{\r\n\t\t\t\t\"Cookie\":\"RPC_TOKEN=\"+rpcToken,\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t//Resolve for server side\r\n\t\tif(cfg.command==\"build\"&&!(cfg.isSsrBuild||(\"ssrBuild\" in cfg&&cfg.ssrBuild))){\r\n\t\t\tconst alias: AliasOptions=(config.resolve??={}).alias??={};\r\n\t\t\tif(Array.isArray(alias))\r\n\t\t\t\t(alias as Alias[]).push({\r\n\t\t\t\t\tfind:\"playify-rpc\",\r\n\t\t\t\t\treplacement:\"/rpc.js\",\r\n\t\t\t\t});\r\n\t\t\telse (alias as Record<string,string>)[\"playify-rpc\"]=\"/rpc.js\";\r\n\t\t}\r\n\t},\r\n});\r\n//export default playifyRpcPlugin;"],"names":["playifyRpcPlugin","__name","devRpcServer","rpcToken","code","_","cfg","importStatement","config","rollupOptions","external","old","s","rest","ssrExternal","alias"],"mappings":";;AAKO,MAAMA,IAAiB,gBAAAC,EAAA,CAACC,IAAqB,yBAAwBC,IAA0B,QAAQ,IAAI,eAA2B;AAAA,EAC5I,MAAK;AAAA,EAEL,UAAUC,GAAKC,GAAEC,GAAiC;AACjD,QAAG,CAACA,GAAK;AAAK;AACd,UAAMC,IAAgB;AACnB,QAACH,EAAK,SAASG,CAAe;AAC1B,aAAA;AAAA,QACN,MAAKH,EAAK,WAAWG,GAAgB,EAAE;AAAA,QACvC,KAAI;AAAA,MAAA;AAAA,EAEN;AAAA,EACA,OAAOC,GAAOF,GAAI;AAEjB,UAAMG,KAAeD,EAAO,UAAQ,CAAC,GAAG,kBAAgB;AACxD,QAAIE,IAASD,EAAc;AACxB,QAAA,MAAM,QAAQC,CAAQ;AAAE,MAAAA,EAAS,KAAK,SAAS;AAAA,aAC1C,OAAOA,KAAW,YAAW;AACpC,YAAMC,IAAID;AACD,MAAAA,IAAA,gBAAAT,EAAA,CAACW,MAAKC,MAAOD,KAAG,aAAWD,EAAIC,GAAE,GAAGC,CAAI,GAAxC;AAAA,IAAwC;MACzCH,KAAU,OAAeA,IAAA,CAACA,GAAS,SAAS,IAChDA,IAAS,CAAC,SAAS;AACxB,IAAAD,EAAc,WAASC,GACvBD,EAAc,gCAA8B;AAG5C,UAAMK,KAAaN,EAAO,QAAM,CAAC,GAAG,aAAW;AAgB5C,QAfAM,KAAa,MAAiBA,EAAA,KAAK,eAAc,SAAS,KAC3DN,EAAO,iBAAe,IAAI,YAAU,CAAA,GAAI,KAAK,eAAc,SAAS,KAGpEA,EAAO,WAAS,CAAA,GAAI,UAAQ,CAAA,GAAI,MAAM,MAAI;AAAA,MAC3C,QAAON;AAAA,MACP,cAAa;AAAA,MACb,IAAG;AAAA,MACH,aAAY;AAAA,MACZ,SAAQC,KAAU,OAAK,SAAU;AAAA,QAChC,QAAS,eAAaA;AAAA,MACvB;AAAA,IAAA,GAIEG,EAAI,WAAS,WAAS,EAAEA,EAAI,cAAa,cAAcA,KAAKA,EAAI,WAAW;AAC7E,YAAMS,KAAqBP,EAAO,YAAU,CAAC,GAAG,UAAQ;AACrD,MAAA,MAAM,QAAQO,CAAK,IACpBA,EAAkB,KAAK;AAAA,QACvB,MAAK;AAAA,QACL,aAAY;AAAA,MAAA,CACZ,IACIA,EAAgC,aAAa,IAAE;AAAA,IACtD;AAAA,EACD;AACD,IApD8B;"}