{"version":3,"file":"vite.cjs","sources":["../src/vite.ts"],"sourcesContent":["// noinspection JSUnusedGlobalSymbols\r\n\r\nimport {Alias,AliasOptions,PluginOption,TransformResult} from \"vite\";\r\n\r\n\r\nconst playifyRpcPlugin=(devRpcServer: string=\"http://127.0.0.1:4590\",rpcToken:string|undefined=process.env.RPC_TOKEN): PluginOption=>({\r\n\tname:\"playify-rpc\",\r\n\r\n\ttransform(code,_,cfg): TransformResult | undefined{\r\n\t\tif(!cfg?.ssr) return;\r\n\t\tconst importStatement='import \"/rpc.js\"';\r\n\t\tif(!code.includes(importStatement)) return;\r\n\t\treturn {\r\n\t\t\tcode:code.replaceAll(importStatement,\"\"),\r\n\t\t\tmap:null,\r\n\t\t};\r\n\t},\r\n\tconfig(config,cfg){\r\n\t\t//Rollup external\r\n\t\tconst rollupOptions=(config.build??={}).rollupOptions??={};\r\n\t\tlet external=rollupOptions.external;\r\n\t\tif(Array.isArray(external))external.push(\"/rpc.js\");\r\n\t\telse if(typeof external===\"function\"){\r\n\t\t\tconst old=external;\r\n\t\t\texternal=(s,...rest)=>s==\"/rpc.js\"||old(s,...rest);\r\n\t\t}else if(external!=null) external=[external,\"/rpc.js\"];\r\n\t\telse external=[\"/rpc.js\"];\r\n\t\trollupOptions.external=external;\r\n\t\trollupOptions.makeAbsoluteExternalsRelative=false;\r\n\r\n\t\t//Prevent from being included as code\r\n\t\tconst ssrExternal=(config.ssr??={}).external??=[];\r\n\t\tif(ssrExternal!=true)ssrExternal.push(\"playify-rpc\",\"/rpc.js\");\r\n\t\t((config.optimizeDeps??={}).exclude??=[]).push(\"playify-rpc\",\"/rpc.js\");\r\n\r\n\t\t//Proxy\r\n\t\t((config.server??={}).proxy??={})[\"/rpc\"]??={\r\n\t\t\ttarget:devRpcServer,\r\n\t\t\tchangeOrigin:true,\r\n\t\t\tws:true,\r\n\t\t\tprependPath:false,\r\n\t\t\theaders:rpcToken==null?undefined:{\r\n\t\t\t\t\"Cookie\":\"RPC_TOKEN=\"+rpcToken,\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t//Resolve for server side\r\n\t\tif(cfg.command==\"build\"&&!(cfg.isSsrBuild||(\"ssrBuild\" in cfg&&cfg.ssrBuild))){\r\n\t\t\tconst alias: AliasOptions=(config.resolve??={}).alias??={};\r\n\t\t\tif(Array.isArray(alias))\r\n\t\t\t\t(alias as Alias[]).push({\r\n\t\t\t\t\tfind:\"playify-rpc\",\r\n\t\t\t\t\treplacement:\"/rpc.js\",\r\n\t\t\t\t});\r\n\t\t\telse (alias as Record<string,string>)[\"playify-rpc\"]=\"/rpc.js\";\r\n\t\t}\r\n\t},\r\n});\r\nexport default playifyRpcPlugin;"],"names":["playifyRpcPlugin","devRpcServer","rpcToken","code","_","cfg","importStatement","config","rollupOptions","external","old","s","rest","ssrExternal","alias"],"mappings":"aAKA,MAAMA,EAAiB,CAACC,EAAqB,wBAAwBC,EAA0B,QAAQ,IAAI,aAA2B,CACrI,KAAK,cAEL,UAAUC,EAAKC,EAAEC,EAAiC,CACjD,GAAG,CAACA,GAAK,IAAK,OACd,MAAMC,EAAgB,mBACnB,GAACH,EAAK,SAASG,CAAe,EAC1B,MAAA,CACN,KAAKH,EAAK,WAAWG,EAAgB,EAAE,EACvC,IAAI,IAAA,CAEN,EACA,OAAOC,EAAOF,EAAI,CAEjB,MAAMG,GAAeD,EAAO,QAAQ,CAAC,GAAG,gBAAgB,GACxD,IAAIE,EAASD,EAAc,SACxB,GAAA,MAAM,QAAQC,CAAQ,EAAEA,EAAS,KAAK,SAAS,UAC1C,OAAOA,GAAW,WAAW,CACpC,MAAMC,EAAID,EACDA,EAAA,CAACE,KAAKC,IAAOD,GAAG,WAAWD,EAAIC,EAAE,GAAGC,CAAI,CAAA,MACzCH,GAAU,KAAeA,EAAA,CAACA,EAAS,SAAS,EAChDA,EAAS,CAAC,SAAS,EACxBD,EAAc,SAASC,EACvBD,EAAc,8BAA8B,GAG5C,MAAMK,GAAaN,EAAO,MAAM,CAAC,GAAG,WAAW,GAgB5C,GAfAM,GAAa,IAAiBA,EAAA,KAAK,cAAc,SAAS,IAC3DN,EAAO,eAAe,IAAI,UAAU,CAAA,GAAI,KAAK,cAAc,SAAS,IAGpEA,EAAO,SAAS,CAAA,GAAI,QAAQ,CAAA,GAAI,MAAM,IAAI,CAC3C,OAAON,EACP,aAAa,GACb,GAAG,GACH,YAAY,GACZ,QAAQC,GAAU,KAAK,OAAU,CAChC,OAAS,aAAaA,CACvB,CAAA,EAIEG,EAAI,SAAS,SAAS,EAAEA,EAAI,YAAa,aAAcA,GAAKA,EAAI,UAAW,CAC7E,MAAMS,GAAqBP,EAAO,UAAU,CAAC,GAAG,QAAQ,GACrD,MAAM,QAAQO,CAAK,EACpBA,EAAkB,KAAK,CACvB,KAAK,cACL,YAAY,SAAA,CACZ,EACIA,EAAgC,aAAa,EAAE,SACtD,CACD,CACD"}